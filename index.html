<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AION Premium - Cyberpunk Dating</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: 
                radial-gradient(circle at 20% 80%, rgba(100, 100, 180, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(120, 100, 180, 0.15) 0%, transparent 50%),
                linear-gradient(135deg, #0f0f1f 0%, #1a1a2f 50%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Киберпанк сетка */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, transparent 79%, rgba(80, 200, 255, 0.02) 80%, transparent 81%),
                linear-gradient(45deg, transparent 79%, rgba(80, 200, 255, 0.01) 80%, transparent 81%);
            background-size: 60px 60px, 40px 40px;
            animation: neuralMove 15s linear infinite;
            pointer-events: none;
            z-index: 1;
        }
        
        @keyframes neuralMove {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 60px 60px, 40px 40px; }
        }
        
        /* Неоновые свечения */
        .glow-effect {
            position: fixed;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(80, 200, 255, 0.08) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 8s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
            filter: blur(40px);
        }
        
        .glow-1 { 
            top: 10%; 
            left: 10%; 
            animation-delay: 0s; 
        }
        .glow-2 { 
            top: 60%; 
            right: 15%; 
            animation-delay: 2s; 
        }
        .glow-3 { 
            bottom: 20%; 
            left: 20%; 
            animation-delay: 4s; 
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) scale(1); }
            33% { transform: translateY(-20px) scale(1.1); }
            66% { transform: translateY(10px) scale(0.9); }
        }
        
        /* Анимация дыхания */
        @keyframes gentleBreath {
            0%, 100% { transform: scale(1); opacity: 0.95; }
            50% { transform: scale(1.02); opacity: 1; }
        }
        
        .auth-container, .card, .subscription-card, .settings-menu, .chat-container {
            animation: gentleBreath 8s ease-in-out infinite;
            will-change: transform, opacity;
        }
        
        /* Контейнер приложения */
        #app {
            position: relative;
            z-index: 2;
            width: 100%;
            max-width: 400px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Кнопка настроек */
        .settings-button {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(20, 20, 35, 0.9);
            border: 1px solid rgba(80, 200, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: 0 0 15px rgba(80, 200, 255, 0.2);
        }
        
        .settings-button:hover {
            transform: scale(1.1) rotate(90deg);
            border-color: rgba(80, 200, 255, 0.6);
            box-shadow: 0 0 25px rgba(80, 200, 255, 0.4);
        }
        
        .settings-icon {
            font-size: 24px;
            color: #80c8ff;
            transition: all 0.3s ease;
        }
        
        /* Индикатор устройства */
        .device-indicator {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(20, 20, 35, 0.9);
            padding: 12px 18px;
            border-radius: 25px;
            color: #80c8ff;
            font-size: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(160, 160, 160, 0.4);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(160, 160, 160, 0.1);
            max-width: 150px;
            text-align: center;
        }
        
        .device-indicator:hover {
            border-color: rgba(100, 200, 255, 0.6);
            box-shadow: 0 0 15px rgba(100, 200, 255, 0.3);
            transform: scale(1.05);
        }
        
        /* Меню настроек */
        .settings-menu {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(20, 20, 35, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(80, 200, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            width: 300px;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: 
                0 0 30px rgba(80, 200, 255, 0.2),
                0 25px 50px rgba(0, 0, 0, 0.4);
            z-index: 999;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
            visibility: hidden;
        }
        
        .settings-menu.active {
            transform: translateX(0);
            opacity: 1;
            visibility: visible;
        }
        
        /* Убираем скролл у body когда меню открыто */
        body.menu-open {
            overflow: hidden;
        }
        
        .settings-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .settings-title {
            font-size: 24px;
            color: #80c8ff;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .settings-subtitle {
            color: rgba(224, 224, 255, 0.7);
            font-size: 14px;
        }
        
        .settings-section {
            margin-bottom: 20px;
        }
        
        .settings-item {
            padding: 15px;
            background: rgba(30, 30, 50, 0.6);
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .settings-item:hover {
            background: rgba(40, 40, 70, 0.8);
            border-color: rgba(80, 200, 255, 0.3);
            transform: translateX(5px);
        }
        
        .settings-item:last-child {
            margin-bottom: 0;
        }
        
        .settings-item-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .settings-icon-small {
            font-size: 18px;
            color: #80c8ff;
            width: 24px;
            text-align: center;
        }
        
        .settings-text {
            color: #e0e0ff;
            font-size: 15px;
            font-weight: 500;
        }
        
        /* Разделитель для настроек */
        .settings-divider {
            height: 1px;
            margin: 15px 0;
            background: radial-gradient(circle, rgba(80, 200, 255, 0.4), transparent);
            opacity: 0.4;
        }
        
        /* Подменю поддержки */
        .support-submenu {
            background: rgba(25, 25, 45, 0.8);
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
            border: 1px solid rgba(80, 200, 255, 0.2);
        }
        
        .support-option {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(80, 200, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .support-option:last-child {
            border-bottom: none;
        }
        
        .support-option:hover {
            background: rgba(80, 200, 255, 0.1);
        }
        
        .support-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        
        .support-text {
            color: #e0e0ff;
            font-size: 14px;
        }
        
        /* Навигационные вкладки */
        .nav-tabs {
            display: flex;
            background: rgba(20, 20, 35, 0.9);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
            border: 1px solid rgba(80, 200, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .nav-tab {
            flex: 1;
            padding: 12px 20px;
            text-align: center;
            background: transparent;
            border: none;
            color: rgba(224, 224, 255, 0.7);
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-tab.active {
            background: rgba(80, 200, 255, 0.15);
            color: #80c8ff;
            box-shadow: 0 0 10px rgba(80, 200, 255, 0.2);
        }
        
        .nav-tab:hover:not(.active) {
            background: rgba(80, 200, 255, 0.05);
            color: #a0d8ff;
        }
        
        /* Стили аутентификации */
        .auth-container {
            background: rgba(20, 20, 35, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(80, 200, 255, 0.2);
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 
                0 0 20px rgba(80, 200, 255, 0.1),
                0 25px 50px rgba(0, 0, 0, 0.3);
            color: #e0e0ff;
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #80c8ff, #a0d8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            letter-spacing: 3px;
        }
        
        .auth-header p {
            opacity: 0.9;
            font-size: 1.1em;
            font-weight: 300;
            color: #a0a0ff;
        }
        
        .input-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        .input-group input, .input-group textarea, .input-group select {
            width: 100%;
            padding: 16px 20px;
            background: rgba(30, 30, 50, 0.8);
            border: 1px solid rgba(80, 200, 255, 0.2);
            border-radius: 12px;
            color: #e0e0ff;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .input-group input::placeholder, .input-group textarea::placeholder {
            color: rgba(160, 160, 255, 0.6);
        }
        
        .input-group input:focus, .input-group textarea:focus, .input-group select:focus {
            outline: none;
            background: rgba(40, 40, 70, 0.9);
            border-color: rgba(80, 200, 255, 0.4);
            box-shadow: 0 0 15px rgba(80, 200, 255, 0.2);
            transform: translateY(-2px);
        }
        
        /* Стили для выбора пола */
        .gender-selection {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .gender-option {
            flex: 1;
            text-align: center;
            padding: 15px;
            background: rgba(30, 30, 50, 0.8);
            border: 1px solid rgba(80, 200, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            color: #a0a0ff;
        }
        
        .gender-option:hover {
            background: rgba(40, 40, 70, 0.9);
            border-color: rgba(80, 200, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .gender-option.selected {
            background: rgba(80, 200, 255, 0.1);
            border-color: rgba(80, 200, 255, 0.5);
            box-shadow: 0 0 10px rgba(80, 200, 255, 0.2);
            color: #80c8ff;
        }
        
        .gender-option .icon {
            font-size: 24px;
            margin-bottom: 5px;
            display: block;
        }
        
        /* Кнопка */
        .btn-primary {
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, #80c8ff, #a0d8ff);
            color: #0f0f1f;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(80, 200, 255, 0.3);
        }
        
        .btn-primary:active {
            transform: translateY(-1px);
        }
        
        /* ИСПРАВЛЕННЫЕ СТИЛИ КАРТОЧЕК */
        .card {
            background: rgba(20, 20, 35, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(80, 200, 255, 0.25);
            border-radius: 20px;
            width: 340px;
            height: 520px;
            box-shadow: 
                0 0 20px rgba(80, 200, 255, 0.15),
                0 25px 50px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
            margin: 0 auto;
            transition: all 0.3s ease;
            transform-style: preserve-3d;
        }
        
        /* Изображение на всю карточку */
        .card-photo {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(80, 200, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(100, 180, 255, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, #1a2a3a 0%, #2a3a4a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
            z-index: 1;
        }
        
        .card-avatar {
            width: 140px;
            height: 140px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 52px;
            color: white;
            border: 3px solid rgba(80, 200, 255, 0.6);
            backdrop-filter: blur(10px);
            box-shadow: 
                0 0 15px rgba(80, 200, 255, 0.4),
                inset 0 0 20px rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        /* Неоновое свечение для аватарки */
        .card-avatar::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: conic-gradient(from 0deg, #80c8ff, #a0d8ff, #80c8ff);
            border-radius: 50%;
            z-index: -1;
            animation: rotate 4s linear infinite;
            filter: blur(8px);
            opacity: 0.6;
        }
        
        .card-avatar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: inherit;
            border-radius: 50%;
            z-index: -1;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Информация о пользователе - ИСПРАВЛЕНО: добавлен полноценный скролл */
        .card-info {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(20, 20, 35, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px;
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.5s ease;
            z-index: 2;
            overflow-y: auto;
            box-sizing: border-box;
        }
        
        .card-info.visible {
            transform: translateY(0);
        }
        
        /* Имя и возраст вверху информации */
        .card-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(80, 200, 255, 0.2);
        }
        
        .card-header h2 {
            font-size: 26px;
            color: #80c8ff;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .card-header .age {
            opacity: 0.9;
            font-size: 20px;
            color: #a0d8ff;
        }
        
        /* Описание пользователя */
        .card-bio {
            color: rgba(224, 224, 255, 0.9);
            line-height: 1.5;
            font-size: 15px;
            margin-bottom: 20px;
        }
        
        /* Детальная информация - ИСПРАВЛЕНО: теперь весь контент виден при скролле */
        .card-details {
            background: rgba(30, 30, 50, 0.7);
            border-radius: 15px;
            padding: 0;
            overflow: hidden;
            border: 1px solid rgba(80, 200, 255, 0.15);
            margin-bottom: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .detail-section {
            padding: 18px;
            border-bottom: 1px solid rgba(80, 200, 255, 0.1);
            flex-shrink: 0;
        }
        
        .detail-section:last-child {
            border-bottom: none;
        }
        
        .detail-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #80c8ff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .detail-section-title::before {
            content: '✦';
            font-size: 14px;
            color: #a0d8ff;
        }
        
        .detail-content {
            color: rgba(224, 224, 255, 0.9);
            line-height: 1.6;
            font-size: 14px;
            overflow: visible;
        }
        
        .detail-content p {
            margin-bottom: 8px;
        }
        
        .detail-content p:last-child {
            margin-bottom: 0;
        }
        
        /* Индикатор для показа информации - ИСПРАВЛЕНО: только надпись */
        .info-toggle {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 20, 35, 0.8);
            border: 1px solid rgba(80, 200, 255, 0.3);
            border-radius: 20px;
            padding: 10px 20px;
            color: #80c8ff;
            font-size: 14px;
            backdrop-filter: blur(10px);
            z-index: 3;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            animation: fadeIn 1s ease 0.5s forwards;
            text-align: center;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
            from { opacity: 0; }
        }
        
        .info-toggle:hover {
            background: rgba(40, 40, 60, 0.9);
            border-color: rgba(80, 200, 255, 0.5);
            transform: translateX(-50%) scale(1.05);
        }
        
        .info-toggle.hidden {
            display: none;
        }
        
        /* Кнопки действий */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 40px;
            padding: 25px 20px;
        }
        
        .action-btn {
            width: 70px;
            height: 70px;
            border: none;
            border-radius: 50%;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .btn-dislike {
            background: rgba(239, 68, 68, 0.15);
            border: 2px solid rgba(255, 100, 100, 0.4);
            color: #ff9999;
        }
        
        .btn-like {
            background: rgba(72, 187, 120, 0.15);
            border: 2px solid rgba(100, 255, 100, 0.4);
            color: #99ff99;
        }
        
        .action-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            transition: all 0.3s ease;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .action-btn:hover::before {
            width: 100px;
            height: 100px;
        }
        
        .action-btn:hover {
            transform: scale(1.1) translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .action-btn:active {
            transform: scale(0.95);
        }
        
        /* Стили для подписок */
        .subscription-container {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            overflow-x: auto;
            padding: 10px 5px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .subscription-container::-webkit-scrollbar {
            display: none;
        }
        
        /* ИСПРАВЛЕНО: уменьшил ширину карточек Plus и Premium */
        .subscription-card {
            background: rgba(20, 20, 35, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 
                0 0 20px rgba(80, 200, 255, 0.1),
                0 25px 50px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            min-width: 270px; /* Уменьшено с 280px до 260px */
            flex-shrink: 0;
            height: 420px;
            display: flex;
            flex-direction: column;
        }
        
        .subscription-card:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 0 30px rgba(80, 200, 255, 0.2),
                0 25px 50px rgba(0, 0, 0, 0.3);
        }
        
        /* Бесплатная версия */
        .subscription-card.free {
            border: 1px solid rgba(160, 160, 160, 0.4);
        }
        
        .subscription-card.free:hover {
            border-color: rgba(200, 200, 200, 0.6);
        }
        
        /* Plus+ версия */
        .subscription-card.plus {
            border: 1px solid rgba(0, 245, 204, 0.6);
        }
        
        .subscription-card.plus:hover {
            border-color: rgba(0, 245, 204, 0.8);
        }
        
        /* PREMIUM версия */
        .subscription-card.premium {
            border: 1px solid rgba(255, 0, 127, 0.6);
        }
        
        .subscription-card.premium:hover {
            border-color: rgba(255, 0, 127, 0.9);
        }
        
        .subscription-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .subscription-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .subscription-card.free .subscription-title {
            color: #a0a0a0;
        }
        
        .subscription-card.plus .subscription-title {
            color: #00F5CC;
        }
        
        .subscription-card.premium .subscription-title {
            color: #FF007F;
        }
        
        .subscription-price {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .subscription-card.free .subscription-price {
            color: #c0c0c0;
        }
        
        .subscription-card.plus .subscription-price {
            color: #00F5CC;
        }
        
        .subscription-card.premium .subscription-price {
            color: #FF007F;
        }
        
        .subscription-period {
            color: rgba(224, 224, 255, 0.7);
            font-size: 14px;
        }
        
        .subscription-features {
            list-style: none;
            margin-bottom: 20px;
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .subscription-features::-webkit-scrollbar {
            width: 4px;
        }
        
        .subscription-features::-webkit-scrollbar-track {
            background: rgba(80, 200, 255, 0.1);
            border-radius: 2px;
        }
        
        .subscription-features::-webkit-scrollbar-thumb {
            background: rgba(80, 200, 255, 0.3);
            border-radius: 2px;
        }
        
        /* ИСПРАВЛЕНО: обновил стили для переносов строк */
        .subscription-features li {
            padding: 8px 0;
            color: rgba(224, 224, 255, 0.9);
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: 13px;
            line-height: 1.3;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .subscription-features li span {
            display: block;
            width: 100%;
        }
        
        .subscription-features li::before {
            content: '✓';
            font-weight: bold;
            flex-shrink: 0;
            margin-top: 2px;
            display: inline-block;
            width: 18px;
            text-align: center;
        }
        
        .subscription-card.free .subscription-features li::before {
            color: #a0a0a0;
        }
        
        .subscription-card.plus .subscription-features li::before {
            color: #00F5CC;
        }
        
        .subscription-card.premium .subscription-features li::before {
            color: #FF007F;
        }
        
        .btn-subscribe {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: auto;
        }
        
        .subscription-card.free .btn-subscribe {
            background: rgba(160, 160, 160, 0.3);
            color: #c0c0c0;
            cursor: not-allowed;
        }
        
        .subscription-card.plus .btn-subscribe {
            background: linear-gradient(45deg, #00F5CC, #00D4AA);
            color: #0f0f1f;
        }
        
        .subscription-card.premium .btn-subscribe {
            background: linear-gradient(45deg, #FF007F, #FF3399);
            color: #0f0f1f;
        }
        
        .btn-subscribe:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .subscription-card.free .btn-subscribe:hover {
            transform: none;
            box-shadow: none;
        }
        
        .subscription-card.plus .btn-subscribe:hover {
            box-shadow: 0 8px 20px rgba(0, 245, 204, 0.3);
        }
        
        .subscription-card.premium .btn-subscribe:hover {
            box-shadow: 0 8px 20px rgba(255, 0, 127, 0.3);
        }
        
        /* Анимации свайпов */
        @keyframes swipeRight {
            0% { transform: translateX(0) rotate(0); }
            50% { transform: translateX(100px) rotate(10deg); }
            100% { transform: translateX(500px) rotate(30deg); opacity: 0; }
        }
        
        @keyframes swipeLeft {
            0% { transform: translateX(0) rotate(0); }
            50% { transform: translateX(-100px) rotate(-10deg); }
            100% { transform: translateX(-500px) rotate(-30deg); opacity: 0; }
        }
        
        @keyframes liquidLike {
            0% { transform: scale(1); }
            25% { transform: scale(1.1) rotate(5deg); }
            50% { transform: scale(0.95) rotate(-5deg); }
            75% { transform: scale(1.05) rotate(2deg); }
            100% { transform: scale(1) rotate(0); }
        }
        
        .swipe-right {
            animation: swipeRight 0.8s ease-in-out forwards;
        }
        
        .swipe-left {
            animation: swipeLeft 0.8s ease-in-out forwards;
        }
        
        .liquid-effect {
            animation: liquidLike 0.6s ease-in-out;
        }
        
        /* Индикатор параллакса */
        .parallax-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(20, 20, 35, 0.9);
            padding: 12px 18px;
            border-radius: 25px;
            color: #80c8ff;
            font-size: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(160, 160, 160, 0.4);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(160, 160, 160, 0.1);
        }
        
        .parallax-indicator.active {
            border-color: rgba(100, 200, 255, 0.6);
            box-shadow: 0 0 15px rgba(100, 200, 255, 0.3);
            color: #80c8ff;
        }
        
        /* Оверлей для меню настроек */
        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .settings-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Модальные окна */
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(20, 20, 35, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(80, 200, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            visibility: visible;
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
        }
        
        .modal-title {
            font-size: 24px;
            color: #80c8ff;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .modal-content {
            color: #e0e0ff;
            line-height: 1.6;
        }
        
        .modal-content p {
            margin-bottom: 15px;
        }
        
        .modal-content ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .modal-content li {
            margin-bottom: 8px;
        }
        
        .modal-close {
            position: fixed;
            top: 25px;
            right: 25px;
            background: rgba(30, 30, 50, 0.8);
            border: 1px solid rgba(80, 200, 255, 0.3);
            color: #80c8ff;
            font-size: 20px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 1002;
            backdrop-filter: blur(10px);
            display: none;
        }
        
        .modal-close.active {
            display: flex;
        }
        
        .modal-close:hover {
            background: rgba(80, 200, 255, 0.2);
            transform: scale(1.1);
        }
        
        /* Оверлей для модальных окон */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Стили для вкладки чата */
        .chat-container {
            background: rgba(20, 20, 35, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(80, 200, 255, 0.2);
            border-radius: 20px;
            padding: 20px;
            height: calc(100vh - 200px);
            display: flex;
            flex-direction: column;
            margin: 0 auto;
            width: 100%;
            max-width: 100%;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            line-height: 1.4;
            word-wrap: break-word;
        }
        
        .message.user {
            align-self: flex-end;
            background: rgba(80, 200, 255, 0.2);
            border: 1px solid rgba(80, 200, 255, 0.4);
            color: #e0e0ff;
            border-bottom-right-radius: 5px;
        }
        
        .message.other {
            align-self: flex-start;
            background: rgba(40, 40, 60, 0.8);
            border: 1px solid rgba(80, 200, 255, 0.3);
            color: #e0e0ff;
            border-bottom-left-radius: 5px;
        }
        
        .message-time {
            font-size: 10px;
            opacity: 0.6;
            margin-top: 5px;
            text-align: right;
        }
        
        .chat-input-container {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 15px;
            background: rgba(30, 30, 50, 0.8);
            border: 1px solid rgba(80, 200, 255, 0.3);
            border-radius: 20px;
            color: #e0e0ff;
            font-size: 14px;
            resize: none;
            min-height: 50px;
            max-height: 120px;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: rgba(80, 200, 255, 0.6);
        }
        
        .chat-send-button {
            padding: 12px 15px;
            background: linear-gradient(45deg, #80c8ff, #a0d8ff);
            border: none;
            border-radius: 50%;
            color: #0f0f1f;
            cursor: pointer;
            font-weight: 600;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .chat-send-button:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(80, 200, 255, 0.4);
        }
        
        .emoji-button {
            padding: 12px 15px;
            background: rgba(30, 30, 50, 0.8);
            border: 1px solid rgba(80, 200, 255, 0.3);
            border-radius: 50%;
            color: #80c8ff;
            cursor: pointer;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .emoji-button:hover {
            background: rgba(80, 200, 255, 0.2);
            transform: scale(1.1);
        }
        
        .emoji-picker {
            position: absolute;
            bottom: 70px;
            background: rgba(20, 20, 35, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(80, 200, 255, 0.3);
            border-radius: 15px;
            padding: 15px;
            display: none;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            z-index: 100;
            max-width: 300px;
        }
        
        .emoji-picker.active {
            display: grid;
            animation: fadeInUp 0.3s ease;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .emoji-option {
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .emoji-option:hover {
            background: rgba(80, 200, 255, 0.2);
            transform: scale(1.2);
        }
        
        /* AI помощник в чате */
        .ai-assistant-chat {
            background: rgba(30, 30, 50, 0.9);
            border: 1px solid rgba(78, 205, 196, 0.4);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: none;
        }
        
        .ai-assistant-chat.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        .ai-suggestions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }
        
        .ai-suggestion-btn {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 10px;
            padding: 10px 12px;
            color: #e0e0ff;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 14px;
        }
        
        .ai-suggestion-btn:hover {
            background: rgba(78, 205, 196, 0.2);
            transform: translateX(5px);
        }
        
        .ai-header {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4ECDC4;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        /* Индикатор модерации */
        .moderation-warning {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(239, 68, 68, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 100, 100, 0.6);
            border-radius: 10px;
            padding: 15px 20px;
            color: white;
            font-weight: 600;
            z-index: 1003;
            display: none;
            animation: fadeInOut 3s ease-in-out;
        }
        
        /* Список чатов */
        .chats-list {
            background: rgba(20, 20, 35, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(80, 200, 255, 0.2);
            border-radius: 20px;
            padding: 20px;
            height: calc(100vh - 200px);
            display: flex;
            flex-direction: column;
            margin: 0 auto;
            width: 100%;
            max-width: 100%;
            overflow-y: auto;
            min-height: 500px;
        }
        
        .chat-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            background: rgba(30, 30, 50, 0.6);
            border: 1px solid transparent;
        }
        
        .chat-item:hover {
            background: rgba(40, 40, 70, 0.8);
            border-color: rgba(80, 200, 255, 0.3);
            transform: translateX(5px);
        }
        
        .chat-item.active {
            background: rgba(80, 200, 255, 0.1);
            border-color: rgba(80, 200, 255, 0.5);
        }
        
        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: rgba(80, 200, 255, 0.2);
            border: 2px solid rgba(80, 200, 255, 0.4);
        }
        
        .chat-info {
            flex: 1;
        }
        
        .chat-name {
            color: #80c8ff;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .chat-last-message {
            color: rgba(224, 224, 255, 0.7);
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }
        
        .chat-time {
            color: rgba(224, 224, 255, 0.5);
            font-size: 12px;
        }
        
        .no-chats {
            text-align: center;
            color: rgba(224, 224, 255, 0.7);
            padding: 40px 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* Переключатель между регистрацией и входом */
        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: rgba(224, 224, 255, 0.7);
        }
        
        .auth-switch a {
            color: #80c8ff;
            text-decoration: none;
            cursor: pointer;
            font-weight: 500;
        }
        
        .auth-switch a:hover {
            text-decoration: underline;
        }
        
        /* Кнопка возврата в чат */
        .back-to-chat-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(20, 20, 35, 0.9);
            border: 1px solid rgba(80, 200, 255, 0.3);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 10;
            color: #80c8ff;
            font-size: 18px;
        }
        
        .back-to-chat-btn:hover {
            transform: scale(1.1);
            border-color: rgba(80, 200, 255, 0.6);
            box-shadow: 0 0 15px rgba(80, 200, 255, 0.3);
        }
        
        /* Контейнер для контента */
        .content-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            position: relative;
            overflow-y: auto;
            padding: 20px 0;
            width: 100%;
            min-height: 500px;
        }
        
        /* Мобильные стили */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            #app {
                max-width: 100%;
                min-height: 100vh;
            }
            
            .card {
                width: 100%;
                max-width: 340px;
                height: 500px;
            }
            
            .settings-menu {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
                top: 80px;
            }
            
            .action-buttons {
                gap: 30px;
                padding: 20px 15px;
            }
            
            .action-btn {
                width: 65px;
                height: 65px;
                font-size: 26px;
            }
            
            .subscription-container {
                padding: 5px;
            }
            
            /* ИСПРАВЛЕНО: уменьшил ширину карточек для мобильных */
            .subscription-card {
                min-width: 250px; /* Уменьшено с 260px до 240px */
                padding: 20px;
                height: 400px;
            }
            
            .subscription-features li {
                font-size: 12px;
                line-height: 1.2;
            }
            
            .parallax-indicator {
                bottom: 10px;
                left: 10px;
                font-size: 11px;
                padding: 10px 15px;
            }

            .device-indicator {
                top: 10px;
                left: 10px;
                font-size: 11px;
                padding: 10px 15px;
                max-width: 130px;
            }
            
            .modal {
                width: 95%;
                padding: 20px;
            }
            
            .modal-close {
                top: 15px;
                right: 15px;
                width: 35px;
                height: 35px;
            }

            .chat-container {
                height: calc(100vh - 180px);
                padding: 15px;
            }

            .emoji-picker {
                max-width: 280px;
                grid-template-columns: repeat(5, 1fr);
            }
            
            .chats-list {
                height: calc(100vh - 180px);
                padding: 15px;
                min-height: 450px;
            }
            
            .back-to-chat-btn {
                top: 15px;
                left: 15px;
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .content-wrapper {
                padding: 10px 0;
                min-height: 450px;
            }
        }
        
        @media (max-width: 480px) {
            .auth-container {
                padding: 30px 20px;
            }
            
            .auth-header h1 {
                font-size: 2.5em;
            }
            
            .card {
                height: 480px;
            }
            
            .card-info {
                padding: 18px 20px 15px 20px;
            }
            
            .card-header h2 {
                font-size: 24px;
            }
            
            .action-buttons {
                gap: 25px;
            }
            
            .action-btn {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
            
            /* ИСПРАВЛЕНО: уменьшил ширину карточек для очень маленьких экранов */
            .subscription-card {
                min-width: 220px; /* Уменьшено с 240px до 220px */
                padding: 15px;
                height: 380px;
            }

            .subscription-features li {
                font-size: 11px;
                line-height: 1.1;
                padding: 6px 0;
            }

            .chat-container {
                height: calc(100vh - 160px);
                padding: 15px;
            }

            .emoji-picker {
                max-width: 250px;
                grid-template-columns: repeat(4, 1fr);
            }
            
            .chats-list {
                height: calc(100vh - 160px);
                padding: 15px;
                min-height: 400px;
            }
            
            .back-to-chat-btn {
                top: 10px;
                left: 10px;
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
            
            .content-wrapper {
                padding: 5px 0;
                min-height: 400px;
            }
        }
        
        /* Поддержка сенсорных устройств */
        @media (hover: none) {
            .action-btn:hover {
                transform: none;
            }
            
            .settings-item:hover {
                transform: none;
                background: rgba(30, 30, 50, 0.6);
            }
            
            .gender-option:hover {
                transform: none;
                background: rgba(30, 30, 50, 0.8);
            }
            
            .nav-tab:hover:not(.active) {
                background: transparent;
            }
            
            .subscription-card:hover {
                transform: none;
            }

            .emoji-option:hover {
                transform: none;
            }

            .ai-suggestion-btn:hover {
                transform: none;
            }

            .chat-send-button:hover {
                transform: none;
            }

            .emoji-button:hover {
                transform: none;
            }
            
            .chat-item:hover {
                transform: none;
            }
            
            .back-to-chat-btn:hover {
                transform: none;
            }
        }
        
        /* Улучшенная поддержка iOS */
        @supports (-webkit-touch-callout: none) {
            body {
                min-height: -webkit-fill-available;
            }
            
            #app {
                min-height: -webkit-fill-available;
            }
        }
    </style>
</head>
<body>
    <!-- Неоновые свечения -->
    <div class="glow-effect glow-1"></div>
    <div class="glow-effect glow-2"></div>
    <div class="glow-effect glow-3"></div>
    
    <!-- Индикатор устройства -->
    <div class="device-indicator" id="device-indicator" onclick="showDeviceInfo()">
        📱 Устройство
    </div>
    
    <!-- Кнопка настроек -->
    <div class="settings-button" id="settings-button" onclick="toggleSettings()">
        <div class="settings-icon">⚙️</div>
    </div>
    
    <!-- Меню настроек -->
    <div class="settings-menu" id="settings-menu">
        <div class="settings-header">
            <div class="settings-title">Настройки</div>
            <div class="settings-subtitle">Управление приложением</div>
        </div>
        
        <div class="settings-section">
            <div class="settings-item" onclick="handleSettingsAction('parallax')">
                <div class="settings-item-content">
                    <div class="settings-icon-small">🎮</div>
                    <div class="settings-text">Управление параллаксом</div>
                </div>
            </div>
            
            <div class="settings-item" onclick="handleSettingsAction('notifications')">
                <div class="settings-item-content">
                    <div class="settings-icon-small">🔔</div>
                    <div class="settings-text">Уведомления</div>
                </div>
            </div>
            
            <div class="settings-item" onclick="handleSettingsAction('theme')">
                <div class="settings-item-content">
                    <div class="settings-icon-small">🎨</div>
                    <div class="settings-text">Тема оформления</div>
                </div>
            </div>
        </div>
        
        <div class="settings-divider"></div>
        
        <div class="settings-section">
            <div class="settings-item" onclick="toggleSupportSubmenu()">
                <div class="settings-item-content">
                    <div class="settings-icon-small">💬</div>
                    <div class="settings-text">Написать в поддержку</div>
                </div>
            </div>
            
            <div class="support-submenu" id="support-submenu" style="display: none;">
                <div class="support-option" onclick="handleSupport('question')">
                    <div class="support-icon">❓</div>
                    <div class="support-text">Вопрос</div>
                </div>
                <div class="support-option" onclick="handleSupport('complaint')">
                    <div class="support-icon">⚠️</div>
                    <div class="support-text">Жалоба</div>
                </div>
                <div class="support-option" onclick="handleSupport('suggestion')">
                    <div class="support-icon">💡</div>
                    <div class="support-text">Предложение</div>
                </div>
            </div>
            
            <div class="settings-item" onclick="showModal('privacy')">
                <div class="settings-item-content">
                    <div class="settings-icon-small">📄</div>
                    <div class="settings-text">Политика конфиденциальности</div>
                </div>
            </div>
            
            <div class="settings-item" onclick="showModal('terms')">
                <div class="settings-item-content">
                    <div class="settings-icon-small">📝</div>
                    <div class="settings-text">Пользовательское соглашение</div>
                </div>
            </div>
            
            <div class="settings-item" onclick="showModal('about')">
                <div class="settings-item-content">
                    <div class="settings-icon-small">ℹ️</div>
                    <div class="settings-text">О приложении</div>
                </div>
            </div>
        </div>
        
        <div class="settings-divider"></div>
        
        <div class="settings-section">
            <div class="settings-item" onclick="logout()" style="border-color: rgba(255, 100, 100, 0.4);">
                <div class="settings-item-content">
                    <div class="settings-icon-small">🚪</div>
                    <div class="settings-text">Выйти из аккаунта</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Оверлей для меню настроек -->
    <div class="settings-overlay" id="settings-overlay" onclick="toggleSettings()"></div>
    
    <!-- Оверлей для модальных окон -->
    <div class="modal-overlay" id="modal-overlay" onclick="closeAllModals()"></div>
    
    <!-- Модальные окна -->
    <div class="modal" id="privacy-modal">
        <div class="modal-header">
            <div class="modal-title">Политика конфиденциальности</div>
        </div>
        <div class="modal-content">
            <p><strong>Последнее обновление:</strong> Январь 2026</p>
            
            <p>Ваша конфиденциальность очень важна для нас. В этой политике конфиденциальности описывается, как AION Premium собирает, использует и защищает вашу личную информацию.</p>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">Собираемая информация</h3>
            <ul>
                <li>Основная информация профиля (имя, возраст, пол)</li>
                <li>Интересы и предпочтения для подбора совместимых партнеров</li>
                <li>Технические данные (устройство, браузер, IP-адрес)</li>
                <li>История взаимодействий с другими пользователями</li>
                <li>Метрики использования приложения</li>
                <li>Сообщения и медиафайлы, отправленные через платформу</li>
            </ul>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">Использование информации</h3>
            <ul>
                <li>Персонализация рекомендаций знакомств</li>
                <li>Улучшение качества сервиса и алгоритмов подбора</li>
                <li>Обеспечение безопасности платформы и предотвращение мошенничества</li>
                <li>Отправка важных уведомлений и обновлений</li>
                <li>Аналитика для улучшения пользовательского опыта</li>
                <li>Соблюдение юридических обязательств</li>
            </ul>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">Защита данных</h3>
            <p>Мы используем современные методы шифрования и защиты данных, включая:</p>
            <ul>
                <li>SSL-шифрование всех передаваемых данных</li>
                <li>Анонимизация аналитических данных</li>
                <li>Регулярные аудиты безопасности</li>
                <li>Ограниченный доступ к персональным данным</li>
            </ul>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">Права пользователей</h3>
            <p>Вы имеете право:</p>
            <ul>
                <li>Запрашивать доступ к вашим персональным данным</li>
                <li>Исправлять неточную информацию</li>
                <li>Удалять ваш аккаунт и связанные данные</li>
                <li>Ограничивать обработку ваших данных</li>
                <li>Переносить ваши данные в другую службу</li>
            </ul>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">Cookies и отслеживание</h3>
            <p>Мы используем cookies и аналогичные технологии для:</p>
            <ul>
                <li>Авторизации и аутентификации</li>
                <li>Запоминания ваших предпочтений</li>
                <li>Анализа использования приложения</li>
                <li>Персонализации контента</li>
            </ul>
            
            <p style="margin-top: 20px; font-size: 14px; color: rgba(224, 224, 255, 0.7);">
                По вопросам, связанным с конфиденциальностью, обращайтесь: privacy@aion-premium.com
            </p>
        </div>
    </div>
    
    <div class="modal" id="terms-modal">
        <div class="modal-header">
            <div class="modal-title">Пользовательское соглашение</div>
        </div>
        <div class="modal-content">
            <p><strong>Условия использования AION Premium</strong></p>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">1. Общие положения</h3>
            <p>Используя приложение AION Premium, вы соглашаетесь с условиями данного соглашения. Сервис предназначен для лиц старше 18 лет.</p>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">2. Регистрация и аккаунт</h3>
            <ul>
                <li>Вы обязаны предоставлять точную и актуальную информацию</li>
                <li>Один пользователь - один аккаунт</li>
                <li>Запрещена передача аккаунта третьим лицам</li>
                <li>Вы несете ответственность за безопасность вашего аккаунта</li>
            </ul>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">3. Правила поведения</h3>
            <ul>
                <li>Запрещено размещение ложной информации</li>
                <li>Не допускается оскорбительное поведение и харассмент</li>
                <li>Запрещена рассылка спама и рекламы</li>
                <li>Нельзя использовать чужие фотографии и персональные данные</li>
                <li>Запрещены любые формы мошенничества</li>
                <li>Не допускается распространение контента для взрослых</li>
                <li>Запрещена пропаганда насилия и дискриминации</li>
            </ul>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">4. Подписки и платежи</h3>
            <ul>
                <li>Подписки автоматически продлеваются</li>
                <li>Вы можете отменить автопродление в настройках вашего устройства</li>
                <li>Возврат средств осуществляется в соответствии с политикой платформы</li>
                <li>Цены могут изменяться с уведомлением пользователей</li>
            </ul>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">5. Интеллектуальная собственность</h3>
            <p>Все права на приложение, дизайн и контент принадлежат AION Technologies. Вы не можете копировать, модифицировать или распространять приложение без разрешения.</p>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">6. Ответственность</h3>
            <p>AION Premium не несет ответственности за:</p>
            <ul>
                <li>Встречи пользователей в реальной жизни</li>
                <li>Достоверность информации, предоставленной пользователями</li>
                <li>Технические сбои, вызванные внешними факторами</li>
                <li>Действия третьих лиц</li>
            </ul>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">7. Прекращение обслуживания</h3>
            <p>Мы оставляем за собой право приостановить или прекратить обслуживание аккаунтов, нарушающих условия соглашения.</p>
            
            <p style="margin-top: 20px; font-size: 14px; color: rgba(224, 224, 255, 0.7);">
                Адрес для юридических уведомлений: legal@aion-premium.com
            </p>
        </div>
    </div>
    
    <div class="modal" id="about-modal">
        <div class="modal-header">
            <div class="modal-title">О приложении AION Premium</div>
        </div>
        <div class="modal-content">
            <p><strong>AION Premium</strong> — это инновационное приложение для знакомств с фокусом на качественные связи и глубокую совместимость.</p>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">Наша миссия</h3>
            <p>Мы создаем пространство, где технологии служат человеческим связям. Наша цель — помочь вам найти не просто matches, а настоящую совместимость через умные алгоритмы и продуманный пользовательский опыт.</p>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">Ключевые особенности</h3>
            <ul>
                <li><strong>Умный алгоритм подбора</strong> на основе психологической совместимости и общих интересов</li>
                <li><strong>3D параллакс-эффекты</strong> для immersive опыта взаимодействия</li>
                <li><strong>Киберпанк дизайн</strong> с неоновой эстетикой и плавными анимациями</li>
                <li><strong>Многоуровневая система подписок</strong> для разных потребностей пользователей</li>
                <li><strong>Расширенная аналитика совместимости</strong> с детальными метриками</li>
                <li><strong>Приватность и безопасность</strong> как основной приоритет</li>
                <li><strong>Адаптивный интерфейс</strong> для всех типов устройств</li>
                <li><strong>AI-помощник</strong> на базе Яндекс GPT для помощи в общении</li>
            </ul>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">Технологический стек</h3>
            <p>Приложение использует современные веб-технологии для обеспечения максимальной производительности:</p>
            <ul>
                <li>HTML5 с семантической разметкой</li>
                <li>CSS3 с продвинутыми анимациями и 3D-трансформациями</li>
                <li>JavaScript ES6+ с современными API</li>
                <li>Adaptive design с mobile-first подходом</li>
                <li>Local Storage для оффлайн-работы и быстрого доступа</li>
                <li>Service Workers для кэширования ресурсов</li>
                <li>WebGL для продвинутой графики (в разработке)</li>
                <li>Yandex GPT API для AI-помощника</li>
            </ul>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">Архитектура приложения</h3>
            <ul>
                <li>Модульная структура кода</li>
                <li>Компонентный подход к UI</li>
                <li>Event-driven архитектура</li>
                <li>Responsive дизайн-система</li>
                <li>Доступность (a11y) стандарты</li>
                <li>AI-интеграция для умной помощи</li>
            </ul>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">Версия и обновления</h3>
            <p><strong>Текущая версия:</strong> 2.1.0</p>
            <p><strong>Дата сборки:</strong> Январь 2026</p>
            <p><strong>Следующее обновление:</strong> Q1 2026 - Умные уведомления</p>
            <p><strong>Разработчик:</strong> AION Technologies</p>
            
            <h3 style="color: #80c8ff; margin: 20px 0 10px 0;">Обратная связь</h3>
            <p>Мы постоянно работаем над улучшением приложения. Ваши отзывы и предложения помогают нам становиться лучше!</p>
            
            <p style="margin-top: 20px; font-size: 14px; color: rgba(224, 224, 255, 0.7);">
                © 2026 AION Premium. Все права защищены.<br>
                AION Technologies - создавая будущее знакомств сегодня.
            </p>
        </div>
    </div>
    
    <!-- Кнопка закрытия для модальных окон -->
    <button class="modal-close" id="modal-close" onclick="closeAllModals()">×</button>
    
    <!-- Индикатор параллакса -->
    <div class="parallax-indicator" id="parallax-indicator" onclick="toggleParallax()">
        🎮 Параллакс: ВКЛ
    </div>
    
    <!-- Предупреждение модерации -->
    <div class="moderation-warning" id="moderation-warning">
        ⚠️ Сообщение содержит неподходящий контент
    </div>
    
    <div id="app">
        <!-- Приложение будет здесь -->
    </div>

    <script>
        // ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ
        let currentCardIndex = 0;
        let currentCard = null;
        let userGender = '';
        let isParallaxActive = true;
        let isMainCardInfoVisible = false;
        let isChatProfileInfoVisible = false;
        let currentTab = 'dating';
        let isSettingsOpen = false;
        let isModalOpen = false;
        let deviceInfo = {};
        let isLoginMode = false;
        
        // ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ДЛЯ AI И ЧАТА
        let chatMessages = [];
        let isEmojiPickerOpen = false;
        let aiSuggestions = [];
        let activeChatId = null;
        let userChats = [];
        
        // СЛОВАРЬ СЛАНГА ДЛЯ AI
        let slangDictionary = {
            'пон': 'понятно',
            'го': 'давай, пойдём, начинай',
            'щас': 'сейчас',
            'норм': 'нормально, хорошо',
            'ок': 'хорошо, согласен',
            'спс': 'спасибо',
            'пж': 'пожалуйста',
            'плз': 'пожалуйста',
            'окей': 'хорошо',
            'агонь': 'отлично, круто',
            'рофл': 'шутка',
            'краш': 'симпатия, человек который нравится',
            'хейт': 'ненависть',
            'имхо': 'по моему скромному мнению',
            'лол': 'смешно',
            'кринж': 'стыд, неловкость',
            'чилить': 'расслабляться',
            'зашквар': 'позор',
            'сасный': 'привлекательный',
            'вайб': 'атмосфера, настроение'
        };
        
        // НЕИЗВЕСТНЫЕ СЛОВА ДЛЯ ОБУЧЕНИЯ AI
        let unknownWords = new Set();
        
        // API конфигурация (ДЛЯ ПРОДАКШЕНА - ВЫНЕСТИ НА БЭКЕНД)
        const BACKEND_API_URL = 'https://ваш-бэкенд.ru/api'; // Заменить на реальный URL
        const YANDEX_API_URL = 'https://llm.api.cloud.yandex.net/foundationModels/v1/completion';

        // Эмодзи для выбора
        const emojis = ['😊', '😂', '🥰', '😍', '🤔', '😎', '👍', '❤️', '🔥', '✨', '🌟', '💫', '💕', '💖', '💯', '🎉', '🙏', '😘', '🤗', '😇', '🥳', '😜', '🤩', '😋', '💝'];

        // ТЕСТОВЫЕ ПОЛЬЗОВАТЕЛИ
        const sampleUsers = [
            { 
                id: 'user_1',
                name: "Анна", 
                age: 25, 
                gender: "female",
                bio: "Люблю путешествия и фотографию. Ищу глубокие и осмысленные отношения. В свободное время занимаюсь йогой и изучаю новые кулинарные рецепты. Обожаю длинные прогулки по городу и открытие новых мест. Верю, что настоящее счастье - в простых моментах и искренних эмоциях.",
                details: {
                    interests: "Фотография, йога, кулинария, путешествия, искусство",
                    lifestyle: "Активный образ жизни, здоровое питание, регулярные тренировки, медитация",
                    goals: "Найти партнера для путешествий и совместного развития\nОткрыть свою фотостудию\nИзучить японский язык",
                    education: "Высшее психологическое образование\nКурсы по фотографии и дизайну",
                    work: "Фотограф-фрилансер\nПреподаватель йоги на выходных",
                    hobbies: "Чтение книг, велопрогулки, посещение выставок\nИзучение психологии отношений\nПриготовление здоровой пищи"
                }
            },
            { 
                id: 'user_2',
                name: "Максим", 
                age: 28, 
                gender: "male",
                bio: "Программист, увлекаюсь спортом и научной фантастикой. Ценю искренность и честность в отношениях. Люблю интеллектуальные беседы и новые вызовы. В свободное время изучаю новые технологии и занимаюсь саморазвитием.",
                details: {
                    interests: "Программирование, бег, научная фантастика, настольные игры, технологии",
                    lifestyle: "Спортивный образ жизни, работа из дома, регулярные пробежки, правильное питание",
                    goals: "Создать семью и развивать собственный проект\nПробежать марафон\nИзучить искусственный интеллект",
                    education: "Магистр компьютерных наук\nСертификаты по машинному обучению",
                    work: "Senior разработчик в IT-компании\nКонсультант по технологиям",
                    hobbies: "Шахматы, походы в горы, коллекционирование комиксов\nЧтение научной литературы\nИгра на гитаре"
                }
            },
            { 
                id: 'user_3',
                name: "София", 
                age: 23, 
                gender: "female",
                bio: "Студентка, обожаю искусство и кофе. Верю, что лучшие отношения строятся на дружбе и взаимопонимании. Люблю посещать выставки и открывать новые кофейни. Мечтаю о путешествии по Италии и изучении итальянского языка.",
                details: {
                    interests: "Искусство, литература, кофе, театр, мода, дизайн",
                    lifestyle: "Активная учеба, встречи с друзьями, творческие вечера, посещение культурных мероприятий",
                    goals: "Закончить университет и открыть свою галерею\nСтать арт-директором\nПутешествовать по Европе",
                    education: "Студентка художественного факультета\nКурсы по истории искусств",
                    work: "Бариста в кофейне\nФриланс-дизайнер",
                    hobbies: "Акварельная живопись, написание рассказов, танцы\nФотография городских пейзажей\nКоллекционирование винтажных открыток"
                }
            },
            { 
                id: 'user_4',
                name: "Александр", 
                age: 30, 
                gender: "male",
                bio: "Предприниматель и путешественник с огромной страстью к жизни. Ищу партнера для совместных приключений и создания чего-то великого вместе. Люблю экстремальные виды спорта, особенно скалолазание и дайвинг. В свободное время изучаю философию и психологию, пишу книгу о своих путешествиях по 50 странам мира. Верю, что настоящая любовь - это когда два человека вдохновляют друг друга становиться лучше каждый день. Ищу женщину с яркой индивидуальностью, чувством юмора и жаждой приключений. Готов поддержать любые начинания и мечты своей спутницы. Важно, чтобы у нас были общие ценности и желание создавать что-то вместе. Не представляю жизнь без путешествий, новых впечатлений и глубоких разговоров до утра.",
                details: {
                    interests: "Путешествия, экстремальные виды спорта, философия, психология, литература, фотография, кулинария, языки, искусство, музыка, театр, кино, архитектура, история, наука, технологии, бизнес, инвестиции, благотворительность",
                    lifestyle: "Активный образ жизни, регулярные тренировки, здоровое питание, медитация, планирование, саморазвитие, работа в режиме номада, частые путешествия, волонтерство",
                    goals: "Создать успешный международный бизнес\nОбъездить все страны мира\nНаписать и издать книгу о путешествиях\nОсновать благотворительный фонд\nПостроить крепкую семью и воспитать детей\nИзучить 5 иностранных языков в совершенстве\nСоздать образовательную платформу для молодежи\nРазработать экологичный бизнес-проект\nИнвестировать в перспективные стартапы\nСоздать сообщество единомышленников",
                    education: "Высшее экономическое образование\nMBA в международной бизнес-школе\nКурсы по психологии и коучингу\nСертификаты по скалолазанию и дайвингу\nИзучение 3 иностранных языков",
                    work: "Основатель IT-компании\nИнвестор в стартапы\nАвтор блога о путешествиях\nКоуч по личностному росту\nКонсультант по бизнес-развитию",
                    hobbies: "Скалолазание, дайвинг, серфинг, горные лыжи\nФотография дикой природы\nЧтение философской литературы\nИгра на фортепиано\nКулинарные эксперименты\nЙога и медитация\nИзучение новых культур\nВолонтерская работа\nНаписание книги\nКоллекционирование винтажных карт"
                }
            }
        ];

        // ОПРЕДЕЛЕНИЕ УСТРОЙСТВА
        function detectDevice() {
            const userAgent = navigator.userAgent.toLowerCase();
            const isMobile = /iphone|ipad|ipod|android|blackberry|windows phone/i.test(userAgent);
            const isIOS = /iphone|ipad|ipod/i.test(userAgent);
            const isAndroid = /android/i.test(userAgent);
            const isiPhone = /iphone/i.test(userAgent);
            const isiPad = /ipad/i.test(userAgent);
            const isSafari = /safari/i.test(userAgent) && !/chrome/i.test(userAgent);
            const isChrome = /chrome/i.test(userAgent);
            const isFirefox = /firefox/i.test(userAgent);
            
            deviceInfo = {
                isMobile,
                isIOS, 
                isAndroid,
                isiPhone,
                isiPad,
                isSafari,
                isChrome,
                isFirefox,
                userAgent: navigator.userAgent,
                screenSize: window.screen.width + 'x' + window.screen.height,
                viewport: window.innerWidth + 'x' + window.innerHeight
            };
            
            updateDeviceIndicator();
            return deviceInfo;
        }

        function updateDeviceIndicator() {
            const indicator = document.getElementById('device-indicator');
            if (indicator) {
                let deviceText = '📱 ';
                if (deviceInfo.isMobile) {
                    if (deviceInfo.isiPhone) deviceText += 'iPhone';
                    else if (deviceInfo.isiPad) deviceText += 'iPad';
                    else if (deviceInfo.isAndroid) deviceText += 'Android';
                    else deviceText += 'Mobile';
                } else {
                    deviceText += 'Desktop';
                }
                
                if (deviceInfo.isSafari) deviceText += ' Safari';
                else if (deviceInfo.isChrome) deviceText += ' Chrome';
                else if (deviceInfo.isFirefox) deviceText += ' Firefox';
                
                indicator.textContent = deviceText;
            }
        }

        function showDeviceInfo() {
            const info = `
📊 Информация об устройстве:

📱 Устройство: ${deviceInfo.isMobile ? 'Мобильное' : 'Десктоп'}
${deviceInfo.isiPhone ? '📱 iPhone' : deviceInfo.isiPad ? '📱 iPad' : deviceInfo.isAndroid ? '🤖 Android' : '💻 Браузер'}

🖥️ Экран: ${deviceInfo.screenSize}
👀 Вьюпорт: ${deviceInfo.viewport}

🌐 Браузер: ${deviceInfo.isSafari ? 'Safari' : deviceInfo.isChrome ? 'Chrome' : deviceInfo.isFirefox ? 'Firefox' : 'Другой'}

📋 User Agent:
${deviceInfo.userAgent}
            `.trim();
            
            alert(info);
        }

        // ИНИЦИАЛИЗАЦИЯ ЧАТОВ
        function initChats() {
            const savedChats = localStorage.getItem('aion_premium_chats');
            if (savedChats) {
                userChats = JSON.parse(savedChats);
            }
            
            // Добавляем демо-чаты если их нет
            if (userChats.length === 0) {
                userChats = [
                    {
                        id: 'chat_1',
                        userId: 'user_1',
                        userName: 'Анна',
                        userAge: 25,
                        userGender: 'female',
                        lastMessage: 'Привет! Как твои дела? 😊',
                        lastMessageTime: new Date(Date.now() - 3600000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                        messages: [
                            {
                                id: 1,
                                text: "Привет! Как твои дела? 😊",
                                sender: "other",
                                time: new Date(Date.now() - 3600000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                            },
                            {
                                id: 2,
                                text: "Привет! Всё отлично, только что закончил(а) работу. А у тебя как?",
                                sender: "user",
                                time: new Date(Date.now() - 3500000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                            }
                        ],
                        unread: 1
                    },
                    {
                        id: 'chat_2', 
                        userId: 'user_2',
                        userName: 'Максим',
                        userAge: 28,
                        userGender: 'male',
                        lastMessage: 'Тоже хорошо! Хотел спросить - не хочешь сходить на кофе в эти выходные? ☕',
                        lastMessageTime: new Date(Date.now() - 7200000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                        messages: [
                            {
                                id: 1,
                                text: "Привет! Вижу у нас много общих интересов!",
                                sender: "other",
                                time: new Date(Date.now() - 7200000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                            },
                            {
                                id: 2,
                                text: "Привет! Да, особенно научная фантастика 😊",
                                sender: "user", 
                                time: new Date(Date.now() - 7000000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                            },
                            {
                                id: 3,
                                text: "Тоже хорошо! Хотел спросить - не хочешь сходить на кофе в эти выходные? ☕",
                                sender: "other",
                                time: new Date(Date.now() - 6800000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                            }
                        ],
                        unread: 0
                    }
                ];
                saveChats();
            }
        }

        // СОХРАНЕНИЕ ЧАТОВ
        function saveChats() {
            localStorage.setItem('aion_premium_chats', JSON.stringify(userChats));
        }

        // ОБРАБОТКА ВЗАИМНОГО ЛАЙКА
        function handleMutualLike(userId) {
            const user = sampleUsers.find(u => u.id === userId);
            if (!user) return;
            
            // Проверяем, есть ли уже чат с этим пользователем
            const existingChat = userChats.find(chat => chat.userId === userId);
            
            if (!existingChat) {
                // Создаем новый чат
                const newChat = {
                    id: 'chat_' + Date.now(),
                    userId: user.id,
                    userName: user.name,
                    userAge: user.age,
                    userGender: user.gender,
                    lastMessage: 'Начните общение! 👋',
                    lastMessageTime: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                    messages: [],
                    unread: 0
                };
                
                userChats.unshift(newChat);
                saveChats();
                
                // Показываем уведомление
                showMatchNotification(user.name);
            }
        }

        // УВЕДОМЛЕНИЕ О МЭТЧЕ
        function showMatchNotification(userName) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(45deg, #80c8ff, #a0d8ff);
                color: #0f0f1f;
                padding: 15px 25px;
                border-radius: 15px;
                font-weight: 600;
                z-index: 1004;
                box-shadow: 0 10px 25px rgba(80, 200, 255, 0.4);
                animation: slideInDown 0.5s ease;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 20px;">🎉</span>
                    <div>
                        <div style="font-weight: 700;">Это взаимно!</div>
                        <div>У вас мэтч с ${escapeHtml(userName)}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutUp 0.5s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
        }

        // ПОЛУЧЕНИЕ АКТИВНОГО ЧАТА
        function getActiveChat() {
            return userChats.find(chat => chat.id === activeChatId);
        }

        // ОТОБРАЖЕНИЕ СПИСКА ЧАТОВ
        function renderChatsList() {
            const container = document.getElementById('content-container');
            container.innerHTML = `
                <div class="chats-list">
                    <h3 style="color: #80c8ff; margin-bottom: 20px; text-align: center;">Ваши чаты</h3>
                    ${userChats.length > 0 ? 
                        userChats.map(chat => `
                            <div class="chat-item ${activeChatId === chat.id ? 'active' : ''}" onclick="openChat('${chat.id}')">
                                <div class="chat-avatar">
                                    ${chat.userGender === 'male' ? '👨' : '👩'}
                                </div>
                                <div class="chat-info">
                                    <div class="chat-name">${escapeHtml(chat.userName)}, ${escapeHtml(chat.userAge)}</div>
                                    <div class="chat-last-message">${escapeHtml(chat.lastMessage)}</div>
                                </div>
                                <div class="chat-time">${escapeHtml(chat.lastMessageTime)}</div>
                            </div>
                        `).join('') 
                        : 
                        `<div class="no-chats">
                            <div style="font-size: 48px; margin-bottom: 15px;">💬</div>
                            <div style="margin-bottom: 10px;">У вас пока нет чатов</div>
                            <div style="font-size: 14px; opacity: 0.7;">Взаимные лайки появятся здесь</div>
                        </div>`
                    }
                </div>
            `;
        }

        // ОТКРЫТИЕ ЧАТА
        function openChat(chatId) {
            activeChatId = chatId;
            const chat = getActiveChat();
            if (chat) {
                chatMessages = chat.messages;
                renderActiveChat();
            }
        }

        // ОТОБРАЖЕНИЕ АКТИВНОГО ЧАТА
        function renderActiveChat() {
            const container = document.getElementById('content-container');
            const chat = getActiveChat();
            
            if (!chat) return;
            
            container.innerHTML = `
                <div class="chat-container">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid rgba(80, 200, 255, 0.2); cursor: pointer;" onclick="showChatProfile('${chat.userId}')">
                        <button onclick="event.stopPropagation(); renderChatsList()" style="background: none; border: none; color: #80c8ff; font-size: 18px; cursor: pointer;">←</button>
                        <div class="chat-avatar" style="width: 40px; height: 40px; font-size: 16px;">
                            ${chat.userGender === 'male' ? '👨' : '👩'}
                        </div>
                        <div style="flex: 1;">
                            <div style="color: #80c8ff; font-weight: 600;">${escapeHtml(chat.userName)}, ${escapeHtml(chat.userAge)}</div>
                            <div style="color: rgba(224, 224, 255, 0.7); font-size: 12px;">в сети</div>
                        </div>
                    </div>
                    
                    <div class="chat-messages" id="chat-messages">
                        <!-- Сообщения будут здесь -->
                    </div>
                    <div class="chat-input-container">
                        <button class="emoji-button" onclick="toggleEmojiPicker()">
                            😊
                        </button>
                        <textarea class="chat-input" id="chat-input" placeholder="Введите сообщение..." rows="1" oninput="handleChatInput()"></textarea>
                        <button class="chat-send-button" onclick="sendChatMessage()">
                            ➤
                        </button>
                    </div>
                    <div class="emoji-picker" id="emoji-picker">
                        <!-- Emoji будут здесь -->
                    </div>
                    <div id="ai-assistant-chat" class="ai-assistant-chat">
                        <!-- AI помощник будет здесь -->
                    </div>
                </div>
            `;
            
            renderChatMessages();
            initEmojiPicker();
            
            // Добавляем обработчик Enter для отправки сообщения
            const chatInput = document.getElementById('chat-input');
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendChatMessage();
                }
            });
            
            // Автоматическое изменение высоты текстового поля
            chatInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
        }

        // ПОКАЗАТЬ ПРОФИЛЬ В ЧАТЕ
        function showChatProfile(userId) {
            const user = sampleUsers.find(u => u.id === userId);
            if (!user) return;
            
            const genderIcon = user.gender === 'male' ? '👨' : '👩';
            
            const container = document.getElementById('content-container');
            container.innerHTML = `
                <div class="back-to-chat-btn" onclick="renderActiveChat()">
                    ←
                </div>
                <div class="card" id="chat-profile-card" style="transform: perspective(1200px) rotateX(0) rotateY(0) rotateZ(0); transition: transform 0.3s ease; width: 100%; max-width: 340px; margin: 0 auto;">
                    <div class="card-photo">
                        <div class="card-avatar">${genderIcon}</div>
                    </div>
                    <div class="card-info">
                        <div class="card-header">
                            <h2>${escapeHtml(user.name)} <span class="age">${escapeHtml(user.age)}</span></h2>
                        </div>
                        <div class="card-bio">${escapeHtml(user.bio)}</div>
                        
                        <div class="card-details">
                            <div class="detail-section">
                                <div class="detail-section-title">Интересы</div>
                                <div class="detail-content">${formatMultilineText(escapeHtml(user.details.interests))}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-section-title">Образ жизни</div>
                                <div class="detail-content">${formatMultilineText(escapeHtml(user.details.lifestyle))}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-section-title">Цели и мечты</div>
                                <div class="detail-content">${formatMultilineText(escapeHtml(user.details.goals))}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-section-title">Образование</div>
                                <div class="detail-content">${formatMultilineText(escapeHtml(user.details.education))}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-section-title">Работа</div>
                                <div class="detail-content">${formatMultilineText(escapeHtml(user.details.work))}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-section-title">Хобби и увлечения</div>
                                <div class="detail-content">${formatMultilineText(escapeHtml(user.details.hobbies))}</div>
                            </div>
                        </div>
                    </div>
                    <div class="info-toggle" onclick="toggleChatCardInfo()">
                        Узнать больше
                    </div>
                </div>
            `;

            // Инициализируем параллакс для профиля в чате
            setTimeout(() => {
                if (isParallaxActive && !isModalOpen) {
                    initChatProfileParallax();
                }
            }, 100);
        }

        // ИНИЦИАЛИЗАЦИЯ ПАРАЛЛАКСА ДЛЯ ПРОФИЛЯ В ЧАТЕ
        function initChatProfileParallax() {
            console.log('🎮 Инициализация параллакса для профиля в чате');
            const card = document.getElementById('chat-profile-card');
            if (card) {
                card.addEventListener('mousemove', handleChatProfileMouseMove);
                card.addEventListener('mouseleave', handleChatProfileMouseLeave);
                
                card.addEventListener('touchmove', handleChatProfileTouchMove, { passive: true });
                card.addEventListener('touchend', handleChatProfileMouseLeave);
            }
        }

        function handleChatProfileMouseMove(event) {
            if (!isParallaxActive || isModalOpen || isChatProfileInfoVisible) return;
            
            const card = event.currentTarget;
            const cardRect = card.getBoundingClientRect();
            
            const mouseX = event.clientX - cardRect.left;
            const mouseY = event.clientY - cardRect.top;
            
            const centerX = cardRect.width / 2;
            const centerY = cardRect.height / 2;
            
            const tiltX = ((mouseX - centerX) / centerX) * 10;
            const tiltY = ((mouseY - centerY) / centerY) * 8;
            
            applyChatProfileTilt(tiltX, tiltY, 0);
        }

        function handleChatProfileTouchMove(event) {
            if (!isParallaxActive || isModalOpen || isChatProfileInfoVisible) return;
            
            const card = event.currentTarget;
            const cardRect = card.getBoundingClientRect();
            const touch = event.touches[0];
            
            const touchX = touch.clientX - cardRect.left;
            const touchY = touch.clientY - cardRect.top;
            
            const centerX = cardRect.width / 2;
            const centerY = cardRect.height / 2;
            
            const tiltX = ((touchX - centerX) / centerX) * 10;
            const tiltY = ((touchY - centerY) / centerY) * 8;
            
            applyChatProfileTilt(tiltX, tiltY, 0);
        }

        function handleChatProfileMouseLeave() {
            if (!isParallaxActive || isModalOpen || isChatProfileInfoVisible) return;
            
            const card = document.getElementById('chat-profile-card');
            if (card) {
                card.style.transform = 'perspective(1200px) rotateX(0) rotateY(0) rotateZ(0)';
                
                const avatar = card.querySelector('.card-avatar');
                if (avatar) {
                    avatar.style.transform = 'translate(0px, 0px)';
                }
                
                const photo = card.querySelector('.card-photo');
                if (photo) {
                    photo.style.backgroundPosition = '0px 0px';
                }
            }
        }

        function applyChatProfileTilt(tiltX, tiltY, rotation) {
            const card = document.getElementById('chat-profile-card');
            if (!card) return;
            
            card.style.transform = `
                perspective(1200px) 
                rotateX(${tiltY}deg) 
                rotateY(${tiltX}deg) 
                rotateZ(${rotation}deg)
                scale(1.02)
            `;
            
            const avatar = card.querySelector('.card-avatar');
            if (avatar) {
                avatar.style.transform = `translate(${-tiltX * 3}px, ${-tiltY * 3}px)`;
            }
            
            const photo = card.querySelector('.card-photo');
            if (photo) {
                photo.style.backgroundPosition = `${tiltX * 2}px ${tiltY * 2}px`;
            }
        }

        // ПЕРЕКЛЮЧЕНИЕ ИНФОРМАЦИИ О КАРТОЧКЕ В ЧАТЕ
        function toggleChatCardInfo() {
            const card = document.getElementById('chat-profile-card');
            const info = card.querySelector('.card-info');
            const indicator = card.querySelector('.info-toggle');
            
            if (info) {
                isChatProfileInfoVisible = !isChatProfileInfoVisible;
                if (isChatProfileInfoVisible) {
                    info.classList.add('visible');
                    indicator.classList.add('hidden');
                    stopChatProfileParallax();
                } else {
                    info.classList.remove('visible');
                    indicator.classList.remove('hidden');
                    if (isParallaxActive && !isModalOpen) {
                        initChatProfileParallax();
                    }
                }
            }
        }

        // ОСТАНОВИТЬ ПАРАЛЛАКС ДЛЯ ПРОФИЛЯ В ЧАТЕ
        function stopChatProfileParallax() {
            const card = document.getElementById('chat-profile-card');
            if (card) {
                card.style.transform = 'perspective(1200px) rotateX(0) rotateY(0) rotateZ(0)';
                
                card.removeEventListener('mousemove', handleChatProfileMouseMove);
                card.removeEventListener('mouseleave', handleChatProfileMouseLeave);
                card.removeEventListener('touchmove', handleChatProfileTouchMove);
                card.removeEventListener('touchend', handleChatProfileMouseLeave);
            }
        }

        // ОТОБРАЖЕНИЕ СООБЩЕНИЙ В ЧАТЕ
        function renderChatMessages() {
            const messagesContainer = document.getElementById('chat-messages');
            if (!messagesContainer) return;

            messagesContainer.innerHTML = '';
            
            chatMessages.forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.className = `message ${message.sender}`;
                messageElement.innerHTML = `
                    ${escapeHtml(message.text)}
                    <div class="message-time">${escapeHtml(message.time)}</div>
                `;
                messagesContainer.appendChild(messageElement);
            });

            // Прокручиваем вниз
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ОБРАБОТКА ВВОДА СООБЩЕНИЯ С AI-ПОМОЩЬЮ
        let inputTimeout;
        function handleChatInput() {
            const input = document.getElementById('chat-input');
            const messageText = input.value.trim();

            // Очищаем предыдущий таймер
            clearTimeout(inputTimeout);
            
            // Если сообщение достаточно длинное, показываем AI-помощника
            if (messageText.length > 3) {
                inputTimeout = setTimeout(() => {
                    showAISuggestions(messageText);
                }, 1000);
            } else {
                hideAISuggestions();
            }
        }

        // АНАЛИЗ И ПРЕОБРАЗОВАНИЕ СЛАНГА
        function analyzeAndTransformSlang(message) {
            const words = message.toLowerCase().split(/\s+/);
            let transformedMessage = message;
            let foundUnknownWords = [];
            
            words.forEach(word => {
                // Убираем знаки препинания
                const cleanWord = word.replace(/[.,!?;:]/g, '');
                
                if (slangDictionary[cleanWord]) {
                    // Заменяем сленг на нормальные слова
                    transformedMessage = transformedMessage.replace(
                        new RegExp(`\\b${cleanWord}\\b`, 'gi'), 
                        slangDictionary[cleanWord]
                    );
                } else if (cleanWord.length > 2 && !isKnownWord(cleanWord)) {
                    // Добавляем в список неизвестных слов
                    foundUnknownWords.push(cleanWord);
                    unknownWords.add(cleanWord);
                }
            });
            
            return {
                transformedMessage,
                foundUnknownWords
            };
        }

        // ПРОВЕРКА ЯВЛЯЕТСЯ ЛИ СЛОВО ИЗВЕСТНЫМ
        function isKnownWord(word) {
            const commonWords = [
                'как', 'что', 'где', 'когда', 'почему', 'кто', 'привет', 'пока',
                'да', 'нет', 'хорошо', 'плохо', 'спасибо', 'пожалуйста', 'извини'
            ];
            
            return commonWords.includes(word) || 
                   Object.keys(slangDictionary).includes(word) ||
                   word.length < 3;
        }

        // УЛУЧШЕННАЯ ФУНКЦИЯ ДЛЯ YANDEX GPT С ОБУЧЕНИЕМ
        async function getAIImprovedMessages(originalMessage, chatContext = null, userProfile = null) {
            try {
                // Анализируем сленг и неизвестные слова
                const { transformedMessage, foundUnknownWords } = analyzeAndTransformSlang(originalMessage);
                
                // Если найдены неизвестные слова, добавляем их в промпт
                let unknownWordsPrompt = '';
                if (foundUnknownWords.length > 0) {
                    unknownWordsPrompt = `\n\nВНИМАНИЕ: Пользователь использовал неизвестные слова: ${foundUnknownWords.join(', ')}. 
                    Если понимаешь их значение, используй в ответе. Если нет, вежливо попроси объяснить значение.`;

                }

                // Более креативный и контекстный промпт
                const systemPrompt = `Ты эксперт в области знакомств и отношений с ярким, харизматичным характером. Твоя задача - помогать пользователям писать интересные, естественные и привлекательные сообщения.

КОНТЕКСТ:
- Платформа для знакомств AION Premium
- Пользователи ищут серьезные отношения
- Важно сохранять искренность и индивидуальность
- Понимай современный сленг: "пон" = понятно, "го" = давай, "норм" = нормально и т.д.

ТВОЙ СТИЛЬ:
- Естественный, дружелюбный, с легкой долей юмора
- Неформальный но уважительный
- Поощряешь открытость и искренность
- Избегаешь шаблонных фраз вроде "звучит интересно"
- Если встречаешь неизвестное слово, вежливо проси объяснить его значение

ЗАДАЧА:
Преобразовать сообщение пользователя в 3 разных варианта, которые:
1. Более привлекательны и вызывают интерес
2. Соответствуют контексту знакомств
3. Сохраняют оригинальный смысл, но подают его лучше
4. Провоцируют продолжение диалога
5. Учитывают сленг если он уместен${unknownWordsPrompt}

ФОРМАТ:
Просто верни 3 варианта, каждый с новой строки, без номеров и пояснений.`;

                // Добавляем контекст если есть
                let contextInfo = "";
                if (userProfile) {
                    contextInfo = `\nПрофиль пользователя: ${userProfile.name}, ${userProfile.age} лет, интересы: ${userProfile.bio || 'не указаны'}`;
                }
                
                if (chatContext && chatContext.length > 0) {
                    const lastMessages = chatContext.slice(-3).map(msg => `${msg.sender}: ${msg.text}`).join('\n');
                    contextInfo += `\nПоследние сообщения в чате:\n${lastMessages}`;
                }

                // Для демо показываем локальные улучшения
                const messageType = analyzeMessageType(transformedMessage);
                return generateCreativeSuggestions(transformedMessage, messageType);
                
            } catch (error) {
                console.error('Ошибка при обращении к AI:', error);
                const messageType = analyzeMessageType(originalMessage);
                return generateCreativeSuggestions(originalMessage, messageType);
            }
        }

        // ГЕНЕРАЦИЯ КРЕАТИВНЫХ ПРЕДЛОЖЕНИЙ ПРИ ОШИБКАХ
        function generateCreativeSuggestions(originalMessage, messageType = null) {
            if (!messageType) {
                messageType = analyzeMessageType(originalMessage);
            }
            
            let suggestions = [];
            
            switch(messageType) {
                case 'greeting':
                    suggestions = [
                        `Привет! Твой профиль сразу привлек внимание - хочется узнать тебя получше 😊`,
                        `Приветствую! У тебя очень интересные увлечения, не расскажешь о них подробнее?`,
                        `Привет! Заметил(а) у нас общие интересы - это здорово! Как твой день?`
                    ];
                    break;
                    
                case 'question':
                    suggestions = [
                        `Отлично, особенно когда нахожу интересных собеседников! А у тебя как настроение?`,
                        `Прекрасно! Твой вопрос уже сделал день лучше) Расскажешь о своем?`,
                        `Всё замечательно, а с твоим появлением в чате стало еще лучше! Как сам(а)?`
                    ];
                    break;
                    
                case 'compliment':
                    suggestions = [
                        `Ты тоже произвел(а) впечатление! Мне особенно понравилось твоё чувство юмора 😊`,
                        `Приятно это слышать! Чувствуется, что у нас может быть хорошее взаимопонимание`,
                        `Спасибо! Ты тоже кажешься очень интересным человеком. Хочется пообщаться поближе`
                    ];
                    break;
                    
                case 'invitation':
                    suggestions = [
                        `Отличная идея! Я бы с радостью встретился(ась). Когда тебе удобно?`,
                        `С удовольствием! Предлагаю в эти выходные - как тебе такой вариант?`,
                        `Здорово! Давай обсудим детали - что тебе больше нравится?`
                    ];
                    break;
                    
                default:
                    suggestions = [
                        `Мне нравится твой подход! "${originalMessage}" - это действительно важно в общении`,
                        `Интересная мысль! "${originalMessage}" - полностью разделяю твою точку зрения`,
                        `Обожаю таких искренних людей! "${originalMessage}" - это так по-настоящему`
                    ];
            }
            
            return suggestions.slice(0, 3);
        }

        // АНАЛИЗ ТИПА СООБЩЕНИЯ
        function analyzeMessageType(message) {
            const msg = message.toLowerCase();
            
            if (msg.includes('?')) return 'question';
            if (msg.includes('нравишься') || msg.includes('симпатия') || msg.includes('красив') || msg.includes('хорош')) return 'compliment';
            if (msg.includes('встреч') || msg.includes('кофе') || msg.includes('гулят') || msg.includes('кино')) return 'invitation';
            if (msg.includes('привет') || msg.includes('здравств') || msg.includes('добр')) return 'greeting';
            
            return 'general';
        }

        // ОБНОВЛЕННАЯ ФУНКЦИЯ ПОКАЗА AI-ПРЕДЛОЖЕНИЙ
        async function showAISuggestions(originalMessage) {
            try {
                // Получаем данные пользователя и контекст чата
                const userData = JSON.parse(localStorage.getItem('aion_premium_user') || '{}');
                const chatContext = chatMessages.slice(-5);
                
                const improvedVersions = await getAIImprovedMessages(originalMessage, chatContext, userData);
                aiSuggestions = improvedVersions;
                renderAISuggestions();
            } catch (error) {
                console.error('Ошибка AI предложений:', error);
                const messageType = analyzeMessageType(originalMessage);
                aiSuggestions = generateCreativeSuggestions(originalMessage, messageType);
                renderAISuggestions();
            }
        }

        // ОТОБРАЗИТЬ ПРЕДЛОЖЕНИЯ AI
        function renderAISuggestions() {
            const chatContainer = document.querySelector('.chat-container');
            let aiAssistant = document.getElementById('ai-assistant-chat');
            
            if (!aiAssistant) {
                aiAssistant = document.createElement('div');
                aiAssistant.id = 'ai-assistant-chat';
                aiAssistant.className = 'ai-assistant-chat';
                chatContainer.insertBefore(aiAssistant, document.querySelector('.chat-input-container'));
            }
            
            aiAssistant.innerHTML = `
                <div class="ai-header">
                    <span>🤖</span>
                    <span>AI предлагает варианты:</span>
                </div>
                <div class="ai-suggestions">
                    ${aiSuggestions.map((suggestion, index) => `
                        <button class="ai-suggestion-btn" onclick="useAISuggestion(${index})">
                            ${escapeHtml(suggestion)}
                        </button>
                    `).join('')}
                </div>
            `;
            
            aiAssistant.classList.add('active');
        }

        // СКРЫТЬ ПРЕДЛОЖЕНИЯ AI
        function hideAISuggestions() {
            const aiAssistant = document.getElementById('ai-assistant-chat');
            if (aiAssistant) {
                aiAssistant.classList.remove('active');
            }
        }

        // ИСПОЛЬЗОВАТЬ ПРЕДЛОЖЕНИЕ AI
        function useAISuggestion(index) {
            const input = document.getElementById('chat-input');
            input.value = aiSuggestions[index];
            input.focus();
            hideAISuggestions();
        }

        // ОТПРАВКА СООБЩЕНИЯ В ЧАТЕ
        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const messageText = input.value.trim();

            if (!messageText) return;

            // Скрываем AI-помощника перед отправкой
            hideAISuggestions();

            // Проверка на неприемлемый контент
            if (await moderateContent(messageText)) {
                showModerationWarning();
                return;
            }

            // Добавляем сообщение пользователя
            const userMessage = {
                id: Date.now(),
                text: messageText,
                sender: 'user',
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };

            chatMessages.push(userMessage);
            
            // Обновляем активный чат
            const activeChat = getActiveChat();
            if (activeChat) {
                activeChat.messages = chatMessages;
                activeChat.lastMessage = messageText;
                activeChat.lastMessageTime = userMessage.time;
                saveChats();
            }
            
            renderChatMessages();
            input.value = '';
            input.style.height = 'auto';

            // Имитируем ответ через 1-3 секунды
            setTimeout(() => {
                const responses = [
                    "Звучит интересно! Расскажи подробнее 😊",
                    "Отличная идея! Мне нравится твой подход",
                    "Хм, никогда об этом не думал(а). Интересная мысль!",
                    "Согласен(на)! Давай обсудим это подробнее",
                    "У тебя всегда такие интересные идеи! 🎉"
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                
                const botMessage = {
                    id: Date.now() + 1,
                    text: randomResponse,
                    sender: 'other',
                    time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                };

                chatMessages.push(botMessage);
                
                // Обновляем активный чат
                if (activeChat) {
                    activeChat.messages = chatMessages;
                    activeChat.lastMessage = randomResponse;
                    activeChat.lastMessageTime = botMessage.time;
                    saveChats();
                }
                
                renderChatMessages();
            }, 1000 + Math.random() * 2000);
        }

        // МОДЕРАЦИЯ КОНТЕНТА
        async function moderateContent(text) {
            const badWords = [
                'хуй', 'пизда', 'ебал', 'ебать', 'блядь', 'гандон', 'мудак', 'сука', 'шлюха',
                'fuck', 'shit', 'bitch', 'asshole', 'dick', 'pussy', 'cock', 'whore'
            ];

            const lowerText = text.toLowerCase();
            
            for (const word of badWords) {
                if (lowerText.includes(word)) {
                    return true;
                }
            }

            const aggressivePatterns = [
                /\b(убью|убить|ненавижу|ненависть|мразь|тварь|скотина)\b/gi,
                /\b(умри|сдохни|пропади|исчезни)\b/gi
            ];

            for (const pattern of aggressivePatterns) {
                if (pattern.test(text)) {
                    return true;
                }
            }

            return false;
        }

        // ПОКАЗАТЬ ПРЕДУПРЕЖДЕНИЕ МОДЕРАЦИИ
        function showModerationWarning() {
            const warning = document.getElementById('moderation-warning');
            warning.style.display = 'block';
            
            setTimeout(() => {
                warning.style.display = 'none';
            }, 3000);
        }

        // УПРАВЛЕНИЕ EMOJI PICKER
        function toggleEmojiPicker() {
            const picker = document.getElementById('emoji-picker');
            isEmojiPickerOpen = !isEmojiPickerOpen;
            
            if (isEmojiPickerOpen) {
                picker.classList.add('active');
            } else {
                picker.classList.remove('active');
            }
        }

        function addEmoji(emoji) {
            const input = document.getElementById('chat-input');
            input.value += emoji;
            input.focus();
            handleChatInput();
        }

        function initEmojiPicker() {
            const picker = document.getElementById('emoji-picker');
            if (picker) {
                picker.innerHTML = '';
                emojis.forEach(emoji => {
                    const emojiElement = document.createElement('div');
                    emojiElement.className = 'emoji-option';
                    emojiElement.textContent = emoji;
                    emojiElement.onclick = () => addEmoji(emoji);
                    picker.appendChild(emojiElement);
                });
            }
        }

        // Закрытие emoji picker при клике вне его
        document.addEventListener('click', (e) => {
            const picker = document.getElementById('emoji-picker');
            const emojiButton = document.querySelector('.emoji-button');
            
            if (picker && emojiButton && isEmojiPickerOpen && 
                !picker.contains(e.target) && 
                !emojiButton.contains(e.target)) {
                toggleEmojiPicker();
            }
        });

        // УПРАВЛЕНИЕ НАСТРОЙКАМИ
        function toggleSettings() {
            if (isModalOpen) return;
            
            const menu = document.getElementById('settings-menu');
            const overlay = document.getElementById('settings-overlay');
            const button = document.getElementById('settings-button');
            
            isSettingsOpen = !isSettingsOpen;
            
            if (isSettingsOpen) {
                document.body.classList.add('menu-open');
                menu.classList.add('active');
                overlay.classList.add('active');
                button.style.transform = 'scale(1.1) rotate(90deg)';
                button.style.borderColor = 'rgba(80, 200, 255, 0.6)';
                button.style.boxShadow = '0 0 25px rgba(80, 200, 255, 0.4)';
                menu.style.overflowY = 'auto';
            } else {
                document.body.classList.remove('menu-open');
                menu.classList.remove('active');
                overlay.classList.remove('active');
                button.style.transform = 'scale(1) rotate(0deg)';
                button.style.borderColor = 'rgba(80, 200, 255, 0.3)';
                button.style.boxShadow = '0 0 15px rgba(80, 200, 255, 0.2)';
                
                const supportSubmenu = document.getElementById('support-submenu');
                if (supportSubmenu) {
                    supportSubmenu.style.display = 'none';
                }
            }
        }

        // ПОДМЕНЮ ПОДДЕРЖКИ
        function toggleSupportSubmenu() {
            const submenu = document.getElementById('support-submenu');
            if (submenu.style.display === 'none') {
                submenu.style.display = 'block';
            } else {
                submenu.style.display = 'none';
            }
        }

        // ОБРАБОТКА ВЫБОРА ПОДДЕРЖКИ
        function handleSupport(type) {
            let message = '';
            switch(type) {
                case 'question':
                    message = '📧 Открыта форма для вопроса в поддержку';
                    break;
                case 'complaint':
                    message = '⚠️ Открыта форма для жалобы';
                    break;
                case 'suggestion':
                    message = '💡 Открыта форма для предложения';
                    break;
            }
            alert(`Форма для ${type === 'question' ? 'вопроса' : type === 'complaint' ? 'жалобы' : 'предложения'} будет реализована в следующем обновлении!`);
            toggleSettings();
        }
        
        // МОДАЛЬНЫЕ ОКНА
        function showModal(type) {
            const modal = document.getElementById(`${type}-modal`);
            const overlay = document.getElementById('modal-overlay');
            const closeBtn = document.getElementById('modal-close');
            
            if (modal) {
                if (isSettingsOpen) {
                    toggleSettings();
                }
                
                modal.classList.add('active');
                overlay.classList.add('active');
                closeBtn.classList.add('active');
                document.body.classList.add('menu-open');
                isModalOpen = true;
            }
        }

        function closeModal(type) {
            const modal = document.getElementById(`${type}-modal`);
            const overlay = document.getElementById('modal-overlay');
            const closeBtn = document.getElementById('modal-close');
            
            if (modal) {
                modal.classList.remove('active');
            }
            overlay.classList.remove('active');
            closeBtn.classList.remove('active');
            document.body.classList.remove('menu-open');
            isModalOpen = false;
        }

        function closeAllModals() {
            const modals = document.querySelectorAll('.modal');
            const overlay = document.getElementById('modal-overlay');
            const closeBtn = document.getElementById('modal-close');
            
            modals.forEach(modal => {
                modal.classList.remove('active');
            });
            
            overlay.classList.remove('active');
            closeBtn.classList.remove('active');
            document.body.classList.remove('menu-open');
            isModalOpen = false;
        }
        
        function handleSettingsAction(action) {
            switch(action) {
                case 'parallax':
                    toggleParallax();
                    break;
                case 'notifications':
                    alert('Настройки уведомлений будут доступны в следующем обновлении');
                    break;
                case 'theme':
                    alert('Смена темы будет доступна в следующем обновлении');
                    break;
            }
            toggleSettings();
        }
        
        // ПАРАЛЛАКС ДЛЯ КАРТОЧЕК
        let isParallaxInitialized = false;
        
        function initParallax() {
            if (isParallaxInitialized) {
                stopParallax();
            }
            
            console.log('🎮 Инициализация параллакса');
            const card = document.getElementById('current-card');
            if (card) {
                card.addEventListener('mousemove', handleCardMouseMove);
                card.addEventListener('mouseleave', handleCardMouseLeave);
                
                card.addEventListener('touchmove', handleCardTouchMove, { passive: true });
                card.addEventListener('touchend', handleCardMouseLeave);
                isParallaxInitialized = true;
            }
        }

        function handleCardMouseMove(event) {
            if (!isParallaxActive || isMainCardInfoVisible || currentTab !== 'dating' || isModalOpen) return;
            
            const card = event.currentTarget;
            const cardRect = card.getBoundingClientRect();
            
            const mouseX = event.clientX - cardRect.left;
            const mouseY = event.clientY - cardRect.top;
            
            const centerX = cardRect.width / 2;
            const centerY = cardRect.height / 2;
            
            const tiltX = ((mouseX - centerX) / centerX) * 10;
            const tiltY = ((mouseY - centerY) / centerY) * 8;
            
            applyCardTilt(tiltX, tiltY, 0);
        }

        function handleCardTouchMove(event) {
            if (!isParallaxActive || isMainCardInfoVisible || currentTab !== 'dating' || isModalOpen) return;
            
            const card = event.currentTarget;
            const cardRect = card.getBoundingClientRect();
            const touch = event.touches[0];
            
            const touchX = touch.clientX - cardRect.left;
            const touchY = touch.clientY - cardRect.top;
            
            const centerX = cardRect.width / 2;
            const centerY = cardRect.height / 2;
            
            const tiltX = ((touchX - centerX) / centerX) * 10;
            const tiltY = ((touchY - centerY) / centerY) * 8;
            
            applyCardTilt(tiltX, tiltY, 0);
        }

        function handleCardMouseLeave() {
            if (!isParallaxActive || isMainCardInfoVisible || currentTab !== 'dating' || isModalOpen) return;
            
            const card = document.getElementById('current-card');
            if (card) {
                card.style.transform = 'perspective(1200px) rotateX(0) rotateY(0) rotateZ(0)';
                
                const avatar = document.querySelector('.card-avatar');
                if (avatar) {
                    avatar.style.transform = 'translate(0px, 0px)';
                }
                
                const photo = document.querySelector('.card-photo');
                if (photo) {
                    photo.style.backgroundPosition = '0px 0px';
                }
            }
        }

        function applyCardTilt(tiltX, tiltY, rotation) {
            const card = document.getElementById('current-card');
            if (!card) return;
            
            card.style.transform = `
                perspective(1200px) 
                rotateX(${tiltY}deg) 
                rotateY(${tiltX}deg) 
                rotateZ(${rotation}deg)
                scale(1.02)
            `;
            
            const avatar = document.querySelector('.card-avatar');
            if (avatar) {
                avatar.style.transform = `translate(${-tiltX * 3}px, ${-tiltY * 3}px)`;
            }
            
            const photo = document.querySelector('.card-photo');
            if (photo) {
                photo.style.backgroundPosition = `${tiltX * 2}px ${tiltY * 2}px`;
            }
        }

        function stopParallax() {
            const card = document.getElementById('current-card');
            if (card) {
                card.style.transform = 'perspective(1200px) rotateX(0) rotateY(0) rotateZ(0)';
                
                card.removeEventListener('mousemove', handleCardMouseMove);
                card.removeEventListener('mouseleave', handleCardMouseLeave);
                card.removeEventListener('touchmove', handleCardTouchMove);
                card.removeEventListener('touchend', handleCardMouseLeave);
                isParallaxInitialized = false;
            }
        }
        
        function toggleParallax() {
            if (isModalOpen) return;
            
            isParallaxActive = !isParallaxActive;
            updateParallaxIndicator(isParallaxActive);
            
            if (isParallaxActive) {
                initParallax();
            } else {
                stopParallax();
            }
        }
        
        function updateParallaxIndicator(active) {
            const indicator = document.getElementById('parallax-indicator');
            if (indicator) {
                if (active) {
                    indicator.innerHTML = `🎮 Параллакс: ВКЛ`;
                    indicator.classList.add('active');
                } else {
                    indicator.innerHTML = `🎮 Параллакс: ВЫКЛ`;
                    indicator.classList.remove('active');
                }
            }
        }
        
        // ПЕРЕКЛЮЧЕНИЕ ВКЛАДОК
        function switchTab(tabName) {
            if (isModalOpen) return;
            
            currentTab = tabName;
            const user = JSON.parse(localStorage.getItem('aion_premium_user'));
            if (user) {
                showMainScreen(user);
            }
        }
        
        // ИНИЦИАЛИЗАЦИЯ ПРИЛОЖЕНИЯ
        function initApp() {
            console.log('🧠 AION Premium запущен');
            
            detectDevice();
            initChats();
            
            if (!('localStorage' in window)) {
                alert('Ваш браузер не поддерживает необходимое для работы приложения. Пожалуйста, обновите браузер.');
                return;
            }
            
            const savedUser = localStorage.getItem('aion_premium_user');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                console.log('✅ Найден пользователь:', user.name);
                showMainScreen(user);
            } else {
                console.log('❌ Пользователь не найден');
                showAuthScreen();
            }
        }
        
        // ЭКРАН АВТОРИЗАЦИИ
        function showAuthScreen() {
            document.getElementById('app').innerHTML = `
                <div class="auth-container">
                    <div class="auth-header">
                        <h1>AION</h1>
                        <p>${isLoginMode ? 'С возвращением!' : 'Место, где знакомства становятся уютными'}</p>
                    </div>
                    
                    <form id="auth-form">
                        ${isLoginMode ? '' : `
                            <div class="input-group">
                                <input type="text" id="name" placeholder="Имя" required maxlength="50">
                            </div>
                            
                            <div class="input-group">
                                <input type="number" id="age" placeholder="Возраст" min="18" max="100" required>
                            </div>

                            <div class="gender-selection">
                                <div class="gender-option" onclick="selectGender(event, 'male')">
                                    <span class="icon">👨</span>
                                    <div>Мужской</div>
                                </div>
                                <div class="gender-option" onclick="selectGender(event, 'female')">
                                    <span class="icon">👩</span>
                                    <div>Женский</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <textarea id="bio" placeholder="Расскажите о себе... Что делает вас счастливым?" rows="3" maxlength="500"></textarea>
                            </div>
                        `}
                        
                        <div class="input-group">
                            <input type="email" id="email" placeholder="Email" required>
                        </div>
                        
                        <div class="input-group">
                            <input type="password" id="password" placeholder="Пароль" required minlength="6">
                        </div>
                        
                        <button type="submit" class="btn-primary">${isLoginMode ? 'Войти' : 'Начать знакомиться'}</button>
                    </form>
                    
                    <div class="auth-switch">
                        ${isLoginMode ? 
                            'Нет аккаунта? <a onclick="toggleAuthMode()">Зарегистрироваться</a>' : 
                            'Уже есть аккаунт? <a onclick="toggleAuthMode()">Войти</a>'
                        }
                    </div>
                    
                    <div class="comfort-text" style="margin-top: 20px; text-align: center; color: rgba(224, 224, 255, 0.7); font-size: 14px;">
                        Здесь не важно количество лайков, а важно качество общения
                        <br>🎮 Наводите мышку на карточку для 3D-параллакс эффекта
                        <br>⚙️ Настройки доступны в правом верхнем углу
                        <br>💬 Новый чат с AI-помощником для улучшения общения
                    </div>
                </div>
            `;
            
            document.getElementById('auth-form').addEventListener('submit', isLoginMode ? handleLogin : handleRegistration);
        }
        
        // ПЕРЕКЛЮЧЕНИЕ РЕЖИМА АВТОРИЗАЦИИ
        function toggleAuthMode() {
            if (isModalOpen) return;
            
            isLoginMode = !isLoginMode;
            showAuthScreen();
        }
        
        // ВЫБОР ПОЛА
        function selectGender(event, gender) {
            if (isModalOpen) return;
            
            userGender = gender;
            document.querySelectorAll('.gender-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
        }
        
        // ОБРАБОТКА РЕГИСТРАЦИИ
        function handleRegistration(e) {
            e.preventDefault();
            if (isModalOpen) return;
            
            console.log('🎯 Начало регистрации');
            
            const name = escapeHtml(document.getElementById('name').value.trim());
            const age = parseInt(document.getElementById('age').value);
            const email = escapeHtml(document.getElementById('email').value.trim());
            const password = document.getElementById('password').value;
            const bio = escapeHtml(document.getElementById('bio').value.trim());
            
            if (!name || !age || !email || !password || !userGender) {
                alert('Пожалуйста, заполните все поля');
                return;
            }
            
            if (age < 18 || age > 100) {
                alert('Для использования приложения вам должно быть от 18 до 100 лет');
                return;
            }
            
            if (password.length < 6) {
                alert('Пароль должен содержать минимум 6 символов');
                return;
            }
            
            // Проверяем email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Пожалуйста, введите корректный email');
                return;
            }
            
            // Проверяем, не зарегистрирован ли уже пользователь с таким email
            const existingUsers = JSON.parse(localStorage.getItem('aion_premium_users') || '[]');
            const existingUser = existingUsers.find(user => user.email === email);
            
            if (existingUser) {
                alert('Пользователь с таким email уже зарегистрирован. Войдите в аккаунт или используйте другой email.');
                return;
            }
            
            // ВНИМАНИЕ: В ПРОДАКШЕНЕ пароли нужно хэшировать на бэкенде!
            const userData = {
                name: name,
                age: age,
                gender: userGender,
                email: email,
                password: password,
                bio: bio,
                id: Date.now().toString(),
                joined: new Date().toISOString()
            };
            
            // Сохраняем пользователя в общий список пользователей
            existingUsers.push(userData);
            localStorage.setItem('aion_premium_users', JSON.stringify(existingUsers));
            
            // Сохраняем текущего пользователя
            localStorage.setItem('aion_premium_user', JSON.stringify(userData));
            
            console.log('💾 Пользователь сохранен:', userData);
            
            document.querySelector('.auth-container').style.opacity = '0';
            document.querySelector('.auth-container').style.transform = 'scale(0.9)';
            
            setTimeout(() => {
                showMainScreen(userData);
            }, 500);
        }
        
        // ОБРАБОТКА ВХОДА
        function handleLogin(e) {
            e.preventDefault();
            if (isModalOpen) return;
            
            console.log('🎯 Попытка входа');
            
            const email = escapeHtml(document.getElementById('email').value.trim());
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                alert('Пожалуйста, заполните все поля');
                return;
            }
            
            // Проверяем email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Пожалуйста, введите корректный email');
                return;
            }
            
            // Ищем пользователя в списке зарегистрированных
            const existingUsers = JSON.parse(localStorage.getItem('aion_premium_users') || '[]');
            const user = existingUsers.find(user => user.email === email && user.password === password);
            
            if (user) {
                console.log('✅ Пользователь найден:', user.name);
                
                // Сохраняем текущего пользователя
                localStorage.setItem('aion_premium_user', JSON.stringify(user));
                
                document.querySelector('.auth-container').style.opacity = '0';
                document.querySelector('.auth-container').style.transform = 'scale(0.9)';
                
                setTimeout(() => {
                    showMainScreen(user);
                }, 500);
            } else {
                alert('Неверный email или пароль. Попробуйте снова или зарегистрируйтесь.');
            }
        }
        
        // ГЛАВНЫЙ ЭКРАН
        function showMainScreen(user) {
            document.getElementById('app').innerHTML = `
                <div style="color: #e0e0ff; text-align: center; width: 100%; min-height: 100vh; display: flex; flex-direction: column;">
                    <div style="background: rgba(20, 20, 35, 0.9); padding: 20px; border-radius: 20px; margin-bottom: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(80, 200, 255, 0.2);">
                        <h1 style="margin-bottom: 5px; background: linear-gradient(45deg, #80c8ff, #a0d8ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">AION</h1>
                        <p>Привет, ${escapeHtml(user.name)}! Найди своего человека</p>
                    </div>
                    
                    <div class="nav-tabs">
                        <button class="nav-tab ${currentTab === 'dating' ? 'active' : ''}" onclick="switchTab('dating')">
                            Знакомства
                        </button>
                        <button class="nav-tab ${currentTab === 'chat' ? 'active' : ''}" onclick="switchTab('chat')">
                            Чат
                        </button>
                        <button class="nav-tab ${currentTab === 'subscription' ? 'active' : ''}" onclick="switchTab('subscription')">
                            Подписка
                        </button>
                    </div>
                    
                    <div class="content-wrapper" id="content-container">
                        <!-- Контент будет здесь -->
                    </div>
                    
                    ${currentTab === 'dating' ? `
                        <div class="action-buttons">
                            <button class="action-btn btn-dislike" onclick="handleSwipe('left')">👎</button>
                            <button class="action-btn btn-like" onclick="handleSwipe('right')">👍</button>
                        </div>
                    ` : ''}
                </div>
            `;
            
            if (currentTab === 'dating') {
                showCurrentCard();
            } else if (currentTab === 'chat') {
                if (activeChatId) {
                    renderActiveChat();
                } else {
                    renderChatsList();
                }
            } else {
                showSubscriptionScreen();
            }
        }
        
        // ЭКРАН ПОДПИСКИ (ИСПРАВЛЕНО - добавлены правильные переносы строк)
        function showSubscriptionScreen() {
            const container = document.getElementById('content-container');
            container.innerHTML = `
                <div style="width: 100%;">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="color: rgba(160, 160, 255, 0.8); font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                            <span style="font-size: 16px;">←</span>
                            Листай в бок
                            <span style="font-size: 16px;">→</span>
                        </div>
                    </div>
                    
                    <div class="subscription-container">
                        <div class="subscription-card free">
                            <div class="subscription-header">
                                <div class="subscription-title">Бесплатно</div>
                                <div class="subscription-price">₽0</div>
                                <div class="subscription-period">навсегда</div>
                            </div>
                            <ul class="subscription-features">
                                <li><span>200 лайков в день</span></li>
                                <li><span>Ai подсказка в 3 чатах 50% от возможности</span></li>
                            </ul>
                            <button class="btn-subscribe" style="cursor: not-allowed;">
                                Активна
                            </button>
                        </div>
                        
                        <div class="subscription-card plus">
                            <div class="subscription-header">
                                <div class="subscription-title">Plus+</div>
                                <div class="subscription-price">₽---</div>
                                <div class="subscription-period">в месяц</div>
                            </div>
                            <ul class="subscription-features">
                                <li><span>Неограниченное количество<br>лайков</span></li>
                                <li><span>5 суперлайков в день</span></li>
                                <li><span>Ai подсказка, 70% процентов от<br>возможного потенциала</span></li>
                                <li><span>Функция возвращения к<br>анкете после дизлайка 5 раз</span></li>
                                <li><span>Приоритетная техническая<br>поддержка</span></li>
                                <li><span>Узнать кто лайкнул тебя</span></li>
                                <li><span>1 сеанс внимания в неделю по<br>три часа (ваша анкета в топе<br>поиска)</span></li>
                            </ul>
                            <button class="btn-subscribe" onclick="handleSubscription('plus')">
                                Выбрать Plus+
                            </button>
                        </div>
                        
                        <div class="subscription-card premium">
                            <div class="subscription-header">
                                <div class="subscription-title">PREMIUM</div>
                                <div class="subscription-price">₽---</div>
                                <div class="subscription-period">в месяц</div>
                            </div>
                            <ul class="subscription-features">
                                <li><span>Все функции Plus версии</span></li>
                                <li><span>10 суперлайков в день</span></li>
                                <li><span>AI подсказка на 100%<br>возможного потенциала</span></li>
                                <li><span>Функция возвращения к<br>анкете после дизлайка<br>беслимитна</span></li>
                                <li><span>Расширенная аналитика<br>совместимости</span></li>
                                <li><span>Приоритетная техническая<br>поддержка</span></li>
                                <li><span>Узнать кто лайкнул тебя</span></li>
                                <li><span>Функция написать не<br>дожидаясь взаимного лайка</span></li>
                                <li><span>Персональный поиск<br>ближайшего партнера по<br>местоположению</span></li>
                                <li><span>3 сеанса внимания в неделю<br>по три часа (ваша анкета в<br>топе поиска)</span></li>
                            </ul>
                            <button class="btn-subscribe" onclick="handleSubscription('premium')">
                                Выбрать PREMIUM
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ОБРАБОТКА ВЫБОРА ПОДПИСКИ
        function handleSubscription(type) {
            if (isModalOpen) return;
            
            const subscriptionName = type === 'plus' ? 'Plus+' : 'PREMIUM';
            alert(`Вы выбрали подписку ${subscriptionName}! В следующем обновлении будет реализована система платежей.`);
        }
        
        // Функция для форматирования текста с переносами строк
        function formatMultilineText(text) {
            return text.split('\n').map(line => `<p>${line}</p>`).join('');
        }
        
        // ПОКАЗАТЬ ТЕКУЩУЮ КАРТОЧКУ
        function showCurrentCard() {
            const container = document.getElementById('content-container');
            
            if (currentCardIndex >= sampleUsers.length) {
                container.innerHTML = `
                    <div style="text-align: center; color: #e0e0ff; padding: 40px;">
                        <h3 style="margin-bottom: 15px; font-size: 24px; color: #80c8ff;">🌸 На сегодня достаточно</h3>
                        <p style="margin-bottom: 20px; opacity: 0.9;">Вы познакомились со всеми анкетами. Завтра появятся новые люди.</p>
                        <button onclick="resetCards()" style="padding: 12px 25px; background: rgba(30, 30, 50, 0.8); color: #e0e0ff; border: 1px solid rgba(80, 200, 255, 0.2); border-radius: 15px; cursor: pointer; backdrop-filter: blur(10px);">
                            Начать заново
                        </button>
                    </div>
                `;
                return;
            }
            
            currentCard = sampleUsers[currentCardIndex];
            const genderIcon = currentCard.gender === 'male' ? '👨' : '👩';
            
            container.innerHTML = `
                <div class="card" id="current-card" style="transform: perspective(1200px) rotateX(0) rotateY(0) rotateZ(0); transition: transform 0.3s ease;">
                    <div class="card-photo">
                        <div class="card-avatar">${genderIcon}</div>
                    </div>
                    <div class="card-info">
                        <div class="card-header">
                            <h2>${escapeHtml(currentCard.name)} <span class="age">${escapeHtml(currentCard.age)}</span></h2>
                        </div>
                        <div class="card-bio">${escapeHtml(currentCard.bio)}</div>
                        
                        <div class="card-details">
                            <div class="detail-section">
                                <div class="detail-section-title">Интересы</div>
                                <div class="detail-content">${formatMultilineText(escapeHtml(currentCard.details.interests))}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-section-title">Образ жизни</div>
                                <div class="detail-content">${formatMultilineText(escapeHtml(currentCard.details.lifestyle))}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-section-title">Цели и мечты</div>
                                <div class="detail-content">${formatMultilineText(escapeHtml(currentCard.details.goals))}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-section-title">Образование</div>
                                <div class="detail-content">${formatMultilineText(escapeHtml(currentCard.details.education))}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-section-title">Работа</div>
                                <div class="detail-content">${formatMultilineText(escapeHtml(currentCard.details.work))}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-section-title">Хобби и увлечения</div>
                                <div class="detail-content">${formatMultilineText(escapeHtml(currentCard.details.hobbies))}</div>
                            </div>
                        </div>
                    </div>
                    <div class="info-toggle" onclick="toggleCardInfo()">
                        Узнать больше
                    </div>
                </div>
            `;

            setTimeout(() => {
                if (isParallaxActive && !isModalOpen) {
                    initParallax();
                }
            }, 100);
        }
        
        // ПЕРЕКЛЮЧЕНИЕ ИНФОРМАЦИИ О КАРТОЧКЕ
        function toggleCardInfo() {
            const card = document.getElementById('current-card');
            const info = card.querySelector('.card-info');
            const indicator = card.querySelector('.info-toggle');
            
            if (info) {
                isMainCardInfoVisible = !isMainCardInfoVisible;
                if (isMainCardInfoVisible) {
                    info.classList.add('visible');
                    indicator.classList.add('hidden');
                    stopParallax();
                } else {
                    info.classList.remove('visible');
                    indicator.classList.remove('hidden');
                    if (isParallaxActive && !isModalOpen) {
                        initParallax();
                    }
                }
            }
        }
        
        // СБРОС КАРТОЧЕК
        function resetCards() {
            if (isModalOpen) return;
            
            currentCardIndex = 0;
            isMainCardInfoVisible = false;
            showCurrentCard();
        }
        
        // ОБРАБОТКА СВАЙПОВ
        function handleSwipe(direction) {
            if (isModalOpen) return;
            
            if (!currentCard) {
                return;
            }

            stopParallax();
            
            const card = document.getElementById('current-card');
            const buttons = document.querySelectorAll('.action-btn');
            
            buttons.forEach(btn => btn.classList.add('liquid-effect'));
            setTimeout(() => {
                buttons.forEach(btn => btn.classList.remove('liquid-effect'));
            }, 600);
            
            if (direction === 'right') {
                card.classList.add('swipe-right');
                
                // С вероятностью 30% создаем мэтч
                if (Math.random() < 0.3) {
                    setTimeout(() => {
                        handleMutualLike(currentCard.id);
                    }, 500);
                }
                
                setTimeout(() => {
                    currentCardIndex++;
                    isMainCardInfoVisible = false;
                    showCurrentCard();
                }, 800);
            } else {
                card.classList.add('swipe-left');
                setTimeout(() => {
                    currentCardIndex++;
                    isMainCardInfoVisible = false;
                    showCurrentCard();
                }, 800);
            }
        }
        
        // ВЫХОД
        function logout() {
            if (isModalOpen) return;
            
            toggleSettings();
            
            setTimeout(() => {
                localStorage.removeItem('aion_premium_user');
                currentCardIndex = 0;
                isMainCardInfoVisible = false;
                isChatProfileInfoVisible = false;
                showAuthScreen();
            }, 1000);
        }
        
        // ФУНКЦИЯ ЭКРАНИРОВАНИЯ HTML
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ЗАПУСК ПРИЛОЖЕНИЯ
        window.addEventListener('load', initApp);
        
        // ДЕЛАЕМ ФУНКЦИИ ГЛОБАЛЬНЫМИ
        window.selectGender = selectGender;
        window.handleSwipe = handleSwipe;
        window.toggleCardInfo = toggleCardInfo;
        window.toggleChatCardInfo = toggleChatCardInfo;
        window.toggleParallax = toggleParallax;
        window.toggleSettings = toggleSettings;
        window.toggleSupportSubmenu = toggleSupportSubmenu;
        window.handleSupport = handleSupport;
        window.showModal = showModal;
        window.closeModal = closeModal;
        window.closeAllModals = closeAllModals;
        window.handleSettingsAction = handleSettingsAction;
        window.switchTab = switchTab;
        window.handleSubscription = handleSubscription;
        window.resetCards = resetCards;
        window.logout = logout;
        window.showDeviceInfo = showDeviceInfo;
        window.sendChatMessage = sendChatMessage;
        window.toggleEmojiPicker = toggleEmojiPicker;
        window.addEmoji = addEmoji;
        window.handleChatInput = handleChatInput;
        window.useAISuggestion = useAISuggestion;
        window.openChat = openChat;
        window.renderChatsList = renderChatsList;
        window.showChatProfile = showChatProfile;
        window.toggleAuthMode = toggleAuthMode;
        window.handleLogin = handleLogin;
    </script>
</body>
</html>
